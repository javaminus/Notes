#一个表有用户和时间两个列，现有3个需求：根据用户查；根据日期查；根据日期和用户查；问怎么建立索引？ 

# 数据库索引设计方案（用户、时间两列）

针对如下三种查询需求：
- ① 根据用户查 👤
- ② 根据日期查 📅
- ③ 根据日期和用户查 👤+📅

推荐的索引设计如下：

---

## 方案一：用户区分度高时（多数情况下更推荐）

| 需求              | 索引类型                         | SQL 示例                                                 | 图标 |
| ----------------- | -------------------------------- | -------------------------------------------------------- | ---- |
| ① 根据用户查      | 联合索引（user, date）的最左前缀 | `CREATE INDEX idx_user_date ON table_name (user, date);` | 👤    |
| ② 根据日期查      | 单列索引                         | `CREATE INDEX idx_date ON table_name (date);`            | 📅    |
| ③ 根据用户+日期查 | 联合索引（user, date）           | `CREATE INDEX idx_user_date ON table_name (user, date);` | 👤+📅  |

> **说明：**  
> - 联合索引 `idx_user_date (user, date)` 可以满足“根据用户查”和“根据用户+日期查”。
> - 单列索引 `idx_date` 满足“根据日期查”。
> - 省去了重复索引，索引更精简。

---

## 方案二：用户区分度低时（如用户数量很少、每用户数据量很大）

| 需求              | 索引类型                         | SQL 示例                                                 | 图标 |
| ----------------- | -------------------------------- | -------------------------------------------------------- | ---- |
| ① 根据用户查      | 单列索引                         | `CREATE INDEX idx_user ON table_name (user);`            | 👤    |
| ② 根据日期查      | 联合索引（date, user）的最左前缀 | `CREATE INDEX idx_date_user ON table_name (date, user);` | 📅    |
| ③ 根据日期+用户查 | 联合索引（date, user）           | `CREATE INDEX idx_date_user ON table_name (date, user);` | 📅+👤  |

> **说明：**
> - 联合索引 `idx_date_user (date, user)` 可以满足“根据日期查”和“根据日期+用户查”。
> - 单列索引 `idx_user` 满足“根据用户查”。
> - 适用于用户数量较少、每个用户数据量很大的场景。

---

## 总结

- **联合索引**可以根据需求覆盖多种查询，避免重复建索引。
- **最左前缀原则**：建立联合索引时，优先考虑常用的过滤条件放在前面。
- 根据实际数据分布（比如用户数量、单用户数据量）灵活调整索引顺序。

---
# 如何从1TB搜索日志中找出搜索量最高的10个关键词？

这是典型的大数据“TopN”问题，数据量远超内存。常用的高效方案如下：

---

## 1️⃣ 哈希分片

- **分治思想**：将日志分成多个小文件（分片），同一个关键词总是落到同一分片。
- 具体做法：
  1. 遍历1TB日志，每条日志提取关键词，对关键词做hash，哈希值对分片数取余，写入对应分片文件。例如分1000片。
  2. 每个分片文件大约只有1GB左右，能被内存处理。

---

## 2️⃣ 分片内统计TopN

- 对每个分片，内存中用哈希表统计所有关键词词频，排序取出该分片Top10。
- 可用大根堆/优先队列存储分片Top10，写入中间结果文件。

---

## 3️⃣ 全局归并TopN

- 将所有分片的Top10合并，得到所有分片的候选Top10000（如果1000分片，每片Top10）。
- 用**最小堆**（size=10）维护全局Top10。
- 遍历所有候选词，若堆未满直接放入，堆满则与堆顶（最小）比较，大于堆顶则替换。
- 堆中最终留下的就是全局Top10。

---

## 4️⃣ 总结流程

1. **哈希分片**：将1TB日志按关键词hash分1000个分片文件。
2. **分片内统计**：每个分片内统计所有关键词，取Top10，写入中间文件。
3. **归并全局Top10**：将所有分片Top10用最小堆归并，得到全局Top10关键词。

---

## 5️⃣ 算法优点

- 单个分片可用内存处理，分片间无交集，减少内存压力。
- 步骤清晰，易并行化处理，工程上易落地。

---

> 💡 **一句话总结：先哈希分片，把同一关键词分到一起，各分片统计TopN，再用最小堆合并所有分片TopN得到全局Top10。**
## UDP 如何保证可靠性？——面试官深问与参考答案

---

### 1. UDP 本身不保证可靠性

UDP（User Datagram Protocol）本身是无连接、不可靠的协议：不保证数据一定送达、不保证顺序、不保证无重复，也没有流量控制和重传机制。因此，**UDP 的可靠性需要应用层自己实现**。

---

### 2. 应用层如何在 UDP 上实现可靠性？

常见方案包括：

1. **添加序列号**  
   每个数据包自定义加序列号，接收方可检测丢包、乱序、重复，按序重组数据。

2. **确认应答（ACK）与重传**  
   发送方等待接收方回传 ACK，若超时未收到则重发数据包（如 TFTP、QUIC、部分游戏协议）。

3. **超时重传机制**  
   发送数据后启动定时器，超时未收到 ACK 则自动重传。

4. **滑动窗口/流量控制**  
   可在应用层实现简单的窗口协议，控制发送速度，避免接收方处理不过来。

5. **校验和和完整性校验**  
   除了 UDP 自带的简单校验和，应用层可用更强的 CRC 或哈希校验，保证数据完整性。

6. **冗余编码和前向纠错（FEC）**  
   发送冗余数据包，丢包时可自动修复，无需重传，提升实时性（如视频流、VoIP）。

---

### 3. 典型协议举例

- **TFTP、QUIC**：在 UDP 上实现了可靠传输机制。
- **实时音视频协议（RTP + RTCP）**：根据需求选择部分可靠性策略，兼顾实时性和数据完整性。
- **DNS**：重要查询可用 TCP 兜底，或客户端自行重试。

---

### 4. 面试官常追问

**Q: 为什么不用 TCP？什么时候一定要用 UDP 加自定义可靠性？**  
A: TCP 适合“可靠且顺序性强”的场景，但其开销和延迟较高。UDP 适用于对实时性要求高、可容忍部分丢包的场景（如语音、视频、游戏），如需可靠性可“按需自定义”，更灵活。

---

## 总结

UDP 本身不可靠，但应用层可通过序列号、ACK、重传、校验、纠错等机制实现“可靠 UDP”。取舍关键在于性能、实时性和业务需求的权衡。
# 问题解析

当A线程在Redis主节点获取分布式锁的同时，Redis发生主从切换（主节点宕机，新的从节点被提升为主），B线程是否可以再次获取到同一把锁，取决于**主从同步的时机**：

---

## 1️⃣ 如果A加锁后，主节点数据已经同步到从节点

- 新主节点有最新的锁数据。
- B线程尝试加锁时，会发现锁已存在，加锁失败。

## 2️⃣ 如果A加锁后，主节点还未来得及同步数据到从节点，主节点就宕机了

- 新主节点并没有A线程的加锁记录。
- B线程看到锁不存在，可以成功加锁。
- 这就造成了**分布式锁的并发安全性丧失**（即同一把锁可能被多方同时获得）。

---

## 结论

**Redis主从切换时，如果主从数据未及时同步，锁的唯一性就无法保证，B线程有可能拿到本不属于它的锁。**

> 这也是为什么单机Redis/哨兵/主从模式下的分布式锁方案不可靠，生产场景一般推荐用 RedLock 或引入多机房多实例一致性机制，或者用ZooKeeper/etcd等专用分布式协调组件实现锁。

---

**一句话总结**：  
A线程加锁后主从未同步就切换主从，B线程有机会再次获取到同一把锁，导致分布式锁失效。
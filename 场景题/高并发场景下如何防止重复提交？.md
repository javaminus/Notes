## 高频高并发面试题 —— “高并发场景下如何防止重复提交？”

### 问题
在高并发环境下，用户可能因为网络抖动、误操作等原因多次提交相同请求，如何设计系统防止重复提交？请结合实际场景，详细说明常见实现方式，并举例说明。

---

### 详细解释

#### 1. 业务场景

- 用户在电商下单，因网络卡顿多次点击“提交订单”，若未做防重处理，可能导致生成多张订单、重复扣款等严重问题。
- 表单重复提交、接口幂等性等也属于重复提交问题的表现。

#### 2. 常见实现方式

- **请求唯一标识（幂等号/Token）**
  - 前端每次请求生成唯一标识（如UUID），服务端收到请求时，先查该标识是否已处理，未处理则执行业务并记录，已处理则直接返回上次结果。
  - 一般用Redis等高性能缓存存储幂等号，并设置合理过期时间。

- **接口防重Token机制**
  - 提交表单前由服务端生成Token，下次提交需带上Token，服务端校验Token有效性，使用后即失效，实现一次性提交。

- **数据库层唯一约束**
  - 在数据库表关键字段加唯一索引，如订单号唯一，重复写入直接失败，业务层捕获异常处理。

- **前端防抖/节流**
  - 前端限制按钮点击频率或操作间隔，减少重复请求。

#### 3. 实际例子

以电商下单为例，前端下单时生成唯一幂等号（orderToken），后端收到请求后在Redis中查找该Token是否已处理。若未处理，正常生成订单并记录Token；若已处理，则直接返回之前的订单信息，防止重复下单。

#### 4. 技术细节与注意事项

- 幂等Token要设置合理过期时间，避免内存/存储泄漏。
- Token生成与分发要保证唯一性和安全性，防止被猜测。
- 数据库唯一约束适合关键业务数据兜底，防止极端情况下出现重复。

---

### 总结性回答（复习提示词）

- **防重提交方案**：幂等Token、接口Token机制、数据库唯一约束、前端防抖/节流
- **高并发推荐**：幂等号+Redis存储，数据库唯一约束兜底
- **记忆口诀**：幂等号拦重复，Token校验防误触，DB唯一兜底忙
好的！关于 **Redis 内存淘汰策略**，这也是面试和实际使用中经常被问到的知识点，我帮你总结得清晰明了👇

---

## **1️⃣ 背景**

- Redis 是**内存数据库**，但内存是有限的。
- 当数据量超过设置的 `maxmemory`（最大内存）限制时，需要**淘汰**部分数据，保证服务可用。
- 淘汰策略通过 `maxmemory-policy` 配置。

---

## **2️⃣ 常见的淘汰策略**

| 策略名                      | 含义                                                          |
|----------------------------|-------------------------------------------------------------|
| **noeviction**             | 默认策略，不淘汰，内存满了后写请求会报错，读请求正常               |
| **allkeys-lru**            | 所有键中，优先淘汰最近最少使用的键（LRU = Least Recently Used）|
| **volatile-lru**           | 仅在设置了过期时间的键中，淘汰最近最少使用的键                    |
| **allkeys-random**         | 所有键中，随机淘汰一个键                                        |
| **volatile-random**        | 仅在设置了过期时间的键中，随机淘汰一个键                         |
| **volatile-ttl**           | 仅在设置了过期时间的键中，优先淘汰剩余 TTL 最短的键               |
| **allkeys-lfu**            | 所有键中，优先淘汰最少频繁使用的键（LFU = Least Frequently Used）|
| **volatile-lfu**           | 仅在设置过期时间的键中，淘汰最少频繁使用的键                      |

---

## **3️⃣ 策略分类**

| 分类         | 策略                         | 说明                                              |
|------------|----------------------------|-------------------------------------------------|
| 不淘汰       | `noeviction`                 | 超出内存限制时直接报错                            |
| LRU         | `allkeys-lru`、`volatile-lru` | 最近最少使用淘汰，适合大多数缓存场景                  |
| LFU         | `allkeys-lfu`、`volatile-lfu` | 最少使用频率淘汰，适合热点数据较稳定的场景              |
| 随机淘汰     | `allkeys-random`、`volatile-random` | 效率高，但不智能                                  |
| TTL 淘汰    | `volatile-ttl`                | 适合需要依赖过期时间控制的业务                       |

---

## **4️⃣ 推荐选择**

| 场景                                        | 推荐策略            |
|-------------------------------------------|------------------|
| **通用缓存系统**                               | `allkeys-lru`     |
| **数据有明确过期时间，重视过期控制**               | `volatile-ttl`    |
| **热点数据访问频繁且固定**                        | `allkeys-lfu`     |
| **不允许数据丢失（如做数据库缓存不一致不可接受）** | `noeviction`      |

---

## **5️⃣ 补充**

- **配置示例**（redis.conf 文件）：
  ```bash
  maxmemory 512mb
  maxmemory-policy allkeys-lru
  ```
- **查看当前配置**：
  ```bash
  CONFIG GET maxmemory-policy
  ```

---

## **6️⃣ 重点面试问法**

> **问**：“Redis 的 LRU 和 LFU 策略是怎么实现的？”  
> 
> **答**：
- LRU：每个 key 维护一个**访问时间戳**，使用近似 LRU 算法，通过抽样方式实现，性能和效果折中。
- LFU：Redis 为每个 key 维护一个**访问频率计数器**，并采用衰减机制，避免冷数据长期占据高频标记。

---

**需要我帮你画一张 Redis 淘汰策略对比图吗？** 🌟


# 线上多节点环境用户进入缓慢，CPU和缓存无压力，排查思路

> 关键信息：多个节点、用户进入缓慢、CPU和缓存无压力

---

## 1️⃣ 问题归因分类

- **个例还是普遍？**
  - 个别用户：用户本地网络、浏览器、梯子、DNS等问题
  - 大面积：服务端、网络链路、依赖等问题

---

## 2️⃣ 重点排查方向

### ① 网络相关分析 🌐

- **带宽限制/网络拥塞**：查看服务器出入带宽，是否接近上限
- **网络延迟/丢包**：ping、traceroute 检查服务器与用户间延迟/丢包
- **CDN异常**：CDN节点是否异常，静态资源是否访问慢
- **负载均衡问题**：配置是否合理，是否有请求被分配到异常或不健康节点

### ② 服务端分析 🖥️

- **应用GC频繁或长时间GC**：虽然CPU低，但GC暂停会卡请求
- **磁盘I/O瓶颈**：应用频繁读写磁盘（如日志刷写慢），导致响应变慢
- **外部接口依赖慢**：如需调用外部API或服务，外部慢也会拖慢整体RT
- **数据库问题**：慢SQL、连接数不足、锁冲突等造成请求阻塞
- **单节点异常**：部分节点健康状况差，负载均衡未及时剔除

### ③ 其他分析 🔍

- **版本发布、预热**：刚上线未预热、缓存未命中、代码更新引入性能问题
- **下游依赖（Redis/MySQL等）**：慢查询、连接耗尽或依赖服务异常
- **虚拟化/宿主机问题**：如虚拟机宿主机异常，导致本机性能下降

---

## 3️⃣ 排查步骤建议

1. **确认影响范围（个别还是全局）**
2. **查看监控，聚焦RT（响应时间）是否真的变长**
3. **流量分析：QPS是否突增，是否有流量洪峰**
4. **检查网络链路（带宽、丢包、延迟）**
5. **负载均衡健康检查，确认请求分配无异常节点**
6. **服务端GC/磁盘I/O/外部依赖/数据库性能监控**
7. **排查发布、预热、缓存失效等运维操作影响**
8. **宿主机及虚拟环境健康检查**

---

## 4️⃣ 扩展建议

- 日志输出是否过量，导致I/O阻塞
- 监控报警误报，先确认是否为真实异常
- 检查依赖服务的超时、失败率
- 关键链路打点/链路追踪（APM）

---

## 5️⃣ 总结表格

| 排查方向    | 重点关注点               | 工具/手段           |
| ----------- | ------------------------ | ------------------- |
| 网络        | 带宽/延迟/丢包/CDN       | ping, traceroute    |
| 负载均衡    | 节点健康、分流策略       | LB控制台/监控       |
| 应用        | GC、I/O、外部依赖、慢SQL | 应用监控/日志/APM   |
| 数据库/缓存 | 慢SQL、连接耗尽、阻塞    | 慢查询日志/监控     |
| 宿主机      | 硬件瓶颈、虚拟化问题     | 云平台/主机运维监控 |
| 版本/运维   | 发布、预热、缓存击穿     | 发布记录/运维平台   |

---

> 面试场景下，思路全、能结合实际案例说明排查流程，体现排查的系统性和细致性，会更受青睐。
## 事务的特性（ACID）

数据库事务有四大特性，简称 **ACID**：

1. **原子性（Atomicity）**  
   事务中的所有操作要么全部完成，要么全部不做，不可中间中断。

2. **一致性（Consistency）**  
   事务执行前后，数据库都必须处于一致的状态，不能破坏数据的完整性和业务规则。

3. **隔离性（Isolation）**  
   并发执行的事务之间相互隔离，一个事务的中间状态对其他事务不可见。不同隔离级别下，表现略有不同。

4. **持久性（Durability）**  
   事务一旦提交，对数据库的修改就是永久性的，即使系统崩溃也不会丢失。

---

## 如何实现（以MySQL InnoDB为例）

### 1. 原子性
- **实现方式：**  
  通过 **Undo Log（回滚日志）** 实现。事务执行过程中会记录每一步的回滚日志，若事务失败或回滚，就依赖Undo Log撤销已完成的操作，保证事务要么全部成功，要么全部失败。

### 2. 一致性
- **实现方式：**  
  依赖于原子性、隔离性和数据库约束（如外键、唯一性约束）共同保障。只有所有操作都成功并提交，数据才能从一个一致状态变到另一个一致状态。

### 3. 隔离性
- **实现方式：**  
  通过 **锁机制（行锁/表锁）** 和 **多版本并发控制（MVCC）** 实现。MySQL 提供四种隔离级别（Read Uncommitted、Read Committed、Repeatable Read、Serializable），InnoDB 默认使用可重复读（Repeatable Read）+MVCC。

### 4. 持久性
- **实现方式：**  
  通过 **Redo Log（重做日志）** 实现。事务提交前，先将操作写入Redo Log，确保即使数据库宕机，重启后也能恢复到已提交状态。

---

## 总结性口诀

- **ACID：原子性、 一致性、 隔离性、 持久性。**
- **Undo Log 保证原子性，Redo Log 保证持久性，锁/MVCC保障隔离性，三者共同保障一致性。**

---

## 面试官可能追问

### 1. 事务的隔离级别有哪些？各自会出现哪些并发问题？
- **四种隔离级别：**  
  Read Uncommitted（读未提交）、Read Committed（读已提交）、Repeatable Read（可重复读，MySQL默认）、Serializable（可串行化）
- **并发问题：**  
  脏读、不可重复读、幻读。

### 2. Undo Log 和 Redo Log 有什么区别？
- **Undo Log**：用于回滚，保证原子性。
- **Redo Log**：用于崩溃恢复，保证持久性。

### 3. MySQL默认的隔离级别是什么？如何实现可重复读？
- **MySQL InnoDB 默认隔离级别：Repeatable Read。**
- **实现机制：** MVCC（多版本并发控制），通过快照读和当前读来实现可重复读，避免不可重复读和大部分幻读。

---
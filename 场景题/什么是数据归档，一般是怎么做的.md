# 什么是数据归档？一般怎么做？

## 1️⃣ 什么是数据归档？

**数据归档**是指将不再频繁访问的历史数据，从主数据库（主表）迁移到更低成本的存储介质或归档库表，以减轻主库/主表的压力，提高主业务系统的查询性能，同时满足合规、审计等数据留存要求。这一过程也称为“冷热数据分离”。

---

## 2️⃣ 数据归档的常见做法

|    归档方式    | 是否常见 | 实现成本 | 支持查询 | 查询性能 |
| :------------: | :------: | :------: | :------: | :------: |
|  分库分表归档  |    ✅     |    低    |    是    |   一般   |
|   分区表归档   |    ✅     |    低    |    是    |   一般   |
|  数据备份归档  |    ❌     |    低    |    否    |    -     |
| 分布式存储归档 |    ✅     |    高    |    是    |    高    |
|  离线数仓归档  |    ✅     |    高    |    是    |    低    |

---

### 1. 分库分表归档（最常见）

- 在主库/主表外，建历史库/表，定期将历史数据迁移。
- 主表与归档表结构一致，一般按时间、状态等字段筛选数据迁移。
- 迁移后主表删除历史数据，主表保留热数据，提升性能。

**示例SQL：**
```sql
-- 迁移历史数据到归档表
INSERT INTO order_history SELECT * FROM orders WHERE create_time < '2023-01-01';
-- 删除主表的历史数据
DELETE FROM orders WHERE create_time < '2023-01-01';
```

---

### 2. 分区表归档（常见）

- 利用MySQL等数据库的**分区表**特性（例如按时间分区）。
- 旧分区可以**快速分离/转移/清理**，归档操作简单高效。
- 适合数据按时间自然老化的场景。

---

### 3. 数据备份归档（互联网较少用）

- 将归档数据**导出为文件**（如SQL、CSV），存储在文件系统、对象存储等。
- 仅用于合规留存，**无法实时查询**。

**示例命令：**
```bash
mysqldump -u user -p db_name table_name > archive_data.sql
aws s3 cp archive_data.sql s3://archive-bucket/
```

---

### 4. 分布式存储归档（常见）

- 历史数据归档到**Hadoop、ClickHouse、Elasticsearch**等分布式存储系统。
- 支持大数据量下的查询分析，成本较高，适合对历史数据有分析需求的场景。

---

### 5. 离线数仓归档（常见）

- 将历史数据同步到**离线数据仓库**（如Hive、Doris等）。
- 主要用于**数据分析、合规审计**，查询性能一般，但支持大规模数据留存、统计分析。

---

## 3️⃣ 总结

- 数据归档的核心目的是**减轻主库压力**、**提升查询性能**、**满足数据保留/合规需求**。
- 选择哪种归档方式，需根据业务查询需求、技术能力、数据量及成本综合考虑。

> 💡 **常用场景：主表只保留近6个月热数据，历史数据归档至归档表或离线仓库，极大提升主业务库性能！**
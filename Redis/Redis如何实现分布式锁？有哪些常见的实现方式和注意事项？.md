**问题：Redis如何实现分布式锁？有哪些常见的实现方式和注意事项？**

**详细解释（结合场景，通俗例子）：**  
在分布式系统中，为了防止多个进程或服务同时操作同一资源导致数据不一致，需要“分布式锁”。Redis由于其高性能和丰富的数据结构，常被用作分布式锁的实现基础。

**常见实现方式：**

1. **基于SETNX命令实现分布式锁：**
   - 通过`SETNX key value`，只有在key不存在时才能设置成功，表示获取到锁。

   - 通常会配合`EXPIRE`或`SET key value NX PX`（带过期时间）一起使用，防止死锁（即持有锁的进程异常未释放）。

   - 解锁通常通过`DEL key`，但要注意“误删”风险（如锁过期时被新线程获取，旧线程再误删锁）。

   - 安全解锁需先校验value是否为自己加的锁（一般用唯一ID标记），然后再删除。

   - > `SET key value NX PX` 是 Redis 的一个常用命令用法，参数含义如下：
     >
     > - `SET key value`：设置指定 key 的值为 value。
     > - `NX`：**只有当 key 不存在时才设置**。如果 key 已经存在，则 SET 不执行任何操作（不会覆盖原有值）。  
     > - `PX <milliseconds>`：**设置 key 的过期时间，单位是毫秒**。即多少毫秒后该 key 会自动被删除。
     >
     > ### 组合语义
     >
     > `SET key value NX PX 10000`
     >
     > 意思是：“只有当 key 不存在时，设置 key 的值为 value，并且该 key 10 秒（10000 毫秒）后自动过期。”
     >
     > ### 例子
     >
     > ```shell
     > SET mykey hello NX PX 5000
     > ```
     > - 如果 `mykey` 不存在，则设置成功，值为 `"hello"`，并且 5 秒后自动删除。
     > - 如果 `mykey` 已存在，则什么都不做。
     >

2. **Redisson等客户端库：**
   - 封装了分布式锁的获取、自动续期、超时释放等功能，使用更安全和便利。

3. **RedLock算法（官方推荐）：**
   - 同时在多个独立Redis节点获取锁，需保证大多数Redis节点加锁成功才算成功，提升高可用性和安全性。

**注意事项：**
- 锁必须有过期时间，避免死锁。
- 解锁前要校验value，防止误删别的线程的锁。
- 单点Redis存在风险，需用RedLock等多节点方案提升可用性。

**通俗例子：**  
就像多人抢占会议室钥匙，只有第一个拿到钥匙的人能进。每个人还要写上自己名字，归还时要核对名字，防止别人抢走或误还。

**总结性回答/提示词：**  
Redis分布式锁常用SETNX+过期时间+唯一标识，解锁要校验value，生产用RedLock提升可靠性。




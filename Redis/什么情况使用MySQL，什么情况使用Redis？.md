## 什么情况使用 MySQL，什么情况使用 Redis？

---

### 一、适合使用 MySQL 的场景

1. **强一致性、事务需求**
   - 需要 ACID 事务（如金融转账、订单系统）
   - 多表关联、复杂查询（如 JOIN、GROUP BY）

2. **持久化存储、大数据量**
   - 需要可靠的数据持久化和恢复能力
   - 历史数据归档、报表、数据分析

3. **关系型结构、复杂逻辑**
   - 需要外键、约束、规范化的数据模型
   - 数据结构关系复杂，需要保证完整性

4. **数据不常变更、写入频率适中**
   - 读写压力可控，数据量大但访问频率中等

---

### 二、适合使用 Redis 的场景

1. **高并发、高性能读写**
   - 秒级、毫秒级的访问要求，如热点数据、排行榜、会话缓存

2. **缓存、临时存储**
   - 缓存热点数据、临时信息（如验证码、临时token）
   - 典型场景：页面缓存、API缓存、热点数据加速

3. **分布式场景**
   - 分布式锁、队列、限流器、计数器等

4. **实时性和原子性操作**
   - 实时排行榜、计分板、实时统计
   - 原子递增/递减、集合操作

5. **数据结构丰富、业务逻辑简单**
   - 利用 String、Hash、List、Set、ZSet、Geo 等高效数据结构

6. **数据可丢失或可重建**
   - 对数据持久性要求不高，丢失数据可接受或可通过重建恢复

---

### 三、两者结合的典型场景（缓存+数据库）

- 用户信息、商品详情等“读多写少”，先查 Redis，未命中再查 MySQL 并回写缓存
- 热点排行榜、活动页缓存、会话信息存储
- 高并发写入先入 Redis 队列，异步批量写入 MySQL

---

### 四、面试常见深问

#### Q1：如果 Redis 宕机，如何保证数据不丢失？
**参考答案**：关键数据应同步写入 MySQL，Redis 仅做缓存或加速层。对于有持久化需求的业务，可以开启 Redis 持久化（AOF、RDB）和主从同步，但最终一致性仍依赖后端数据库。

#### Q2：如何保证缓存和数据库的数据一致性？
**参考答案**：可采用“先更新数据库，再删除缓存”策略，或引入消息队列/延迟双删等机制，避免脏读和缓存雪崩。

#### Q3：为什么不能只用 Redis 代替 MySQL？
**参考答案**：Redis 是内存数据库，成本高，数据易丢失，不适合海量、强持久性和复杂查询场景。MySQL 适合做主数据存储，Redis 适合做加速和高频业务的补充。

---

## 总结

- **MySQL**：主存储、强一致、复杂关系、持久化
- **Redis**：高并发缓存、实时性、分布式场景、数据结构操作
- **两者结合**：大多数互联网系统的标配架构

## MySQL 与 Redis 选择——面试官深问问题与参考答案

---

### 1. 为什么不能用 Redis 替代 MySQL？

**参考答案：**  
Redis 是内存数据库，适合高并发、低延迟场景，但内存成本高且数据易丢失，不支持复杂查询和关系操作。MySQL 支持持久化存储、ACID 事务和复杂 SQL，适合对数据安全性、一致性和结构化关系要求高的业务场景。

---

### 2. 缓存穿透、缓存雪崩和缓存击穿分别是什么？如何解决？

**参考答案：**  
- 缓存穿透：查询不存在的 key，缓存和数据库都无数据。可用布隆过滤器、空对象缓存等方式防止。
- 缓存击穿：热点 key 失效，大量请求同时访问数据库。可用互斥锁、热点预加载等缓解。
- 缓存雪崩：大量 key 同时过期或 Redis 挂掉，导致数据库压力激增。可用过期时间随机化、分布式部署、降级限流等措施防护。

---

### 3. 如何保证 Redis 和 MySQL 的数据一致性？

**参考答案：**  
推荐“先更新数据库，再删除缓存”策略，避免读到脏数据。也可以通过延迟双删、消息队列、binlog 增量订阅等方式进一步保证一致性。对于极端一致性需求，建议只以数据库为准。

---

### 4. Redis 适合存储哪些类型的数据？MySQL 适合哪些？

**参考答案：**  
Redis 适合存储热点数据、临时数据、计数、排行榜、会话、分布式锁等高并发、实时要求高且可丢失或可重建的数据。MySQL 适合存结构化关系数据、业务主数据、历史记录、账单、订单等必须持久化的核心数据。

---

### 5. 在高并发场景下，如何保证缓存和数据库的一致性且不影响性能？

**参考答案：**  
可以采用异步失效、延迟双删、异步消息队列等方式，先写数据库，删缓存，业务主流程不等待缓存更新。也可以通过分布式锁、批量写入、分片等手段优化整体性能。

---

### 6. 数据量很大时，如何设计 Redis 和 MySQL 的协作方案？

**参考答案：**  
只将热点数据或高频访问数据缓存到 Redis，冷数据保留在 MySQL。定期同步、淘汰不活跃数据，结合分布式 Redis、分库分表、读写分离等架构提升整体可用性与扩展性。

---

### 7. 如果 Redis 缓存失效，系统如何保证可用性？

**参考答案：**  
应保证数据库能承受短时间的回源流量，或通过降级限流、热点预加载、备用缓存等措施缓解压力。生产环境建议 Redis 主从、哨兵、集群等高可用部署，避免单点故障。

---

### 8. 数据一致性和高可用性发生冲突时如何权衡？

**参考答案：**  
一致性和可用性本质上是权衡关系。对核心业务（如支付、订单）应优先保证一致性，缓存仅做加速；对非核心、读多写少场景可优先高可用，允许短暂不一致。

---

### 9. Redis 的哪些数据结构适合哪些场景？举例说明。

**参考答案：**  
- String：计数器、缓存对象
- Hash：用户信息、配置项
- List：消息队列、任务列表
- Set：标签、去重
- ZSet：排行榜、延迟队列
  根据业务特点选择合适的数据结构，提高效率。

---

### 10. MySQL 与 Redis 联合使用时，常见的架构模式有哪些？

**参考答案：**  
典型模式有 Cache Aside（旁路缓存）、Read/Write Through、Write Back 等。最常用的是 Cache Aside，先查缓存，未命中查数据库并回写缓存，写操作先更新数据库再删缓存。

---

## 总结

面试深问时，要关注两者各自优势、协作方式、数据一致性、可用性、性能优化及实际落地的架构方案。
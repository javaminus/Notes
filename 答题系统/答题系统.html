<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§  å…«è‚¡æ–‡å¤ä¹ ç³»ç»Ÿ - javaminus</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei UI", "SF Pro Display", "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #0D1117 0%, #161B22 100%);
            color: #F0F6FC;
            overflow-x: hidden;
        }

        /* ä¸»å¸ƒå±€ */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* æ ‡é¢˜æ  */
        .title-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(90deg, #58A6FF 0%, #7C3AED 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(88, 166, 255, 0.3);
            z-index: 1000;
        }

        .title-text {
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .user-info {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 250px;
            background: #161B22;
            padding: 80px 20px 20px;
            border-right: 1px solid #30363D;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .nav-button {
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: transparent;
            color: #7D8590;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            text-align: left;
        }

        .nav-button:hover {
            background: #21262D;
            color: #58A6FF;
            box-shadow: 0 1px 5px rgba(88, 166, 255, 0.2);
            transform: translateX(5px);
        }

        .nav-button.active {
            background: #58A6FF;
            color: white;
            box-shadow: 0 2px 8px rgba(88, 166, 255, 0.4);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 80px 30px 30px;
            min-height: 100vh;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: #161B22;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #30363D;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 20px rgba(88, 166, 255, 0.2);
            border-color: #58A6FF;
        }

        /* é—®é¢˜å¡ç‰‡ */
        .question-card {
            background: linear-gradient(135deg, #161B22 0%, #1C2128 100%);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #30363D;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            min-height: 300px;
        }

        .question-text {
            font-size: 28px;
            line-height: 1.6;
            color: #F0F6FC;
            margin-bottom: 20px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-primary {
            background: linear-gradient(135deg, #58A6FF 0%, #7C3AED 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 3px 10px rgba(88, 166, 255, 0.3);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            box-shadow: 0 5px 15px rgba(88, 166, 255, 0.5);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: #58A6FF;
            border: 2px solid #58A6FF;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(88, 166, 255, 0.1);
            box-shadow: 0 2px 8px rgba(88, 166, 255, 0.3);
        }

        .btn-danger {
            background: transparent;
            color: #F85149;
            border: 2px solid #F85149;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: rgba(248, 81, 73, 0.1);
            box-shadow: 0 2px 8px rgba(248, 81, 73, 0.3);
        }

        /* è¯­éŸ³æŒ‰é’® */
        .voice-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #F85149 0%, #FF6B9D 100%);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(248, 81, 73, 0.4);
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            box-shadow: 0 8px 20px rgba(248, 81, 73, 0.6);
            transform: scale(1.1);
        }

        .voice-btn.recording {
            background: linear-gradient(135deg, #3FB950 0%, #06D6A0 100%);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .form-input {
            width: 100%;
            padding: 15px;
            background: #21262D;
            color: #F0F6FC;
            border: 2px solid #30363D;
            border-radius: 10px;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #58A6FF;
            box-shadow: 0 0 5px rgba(88, 166, 255, 0.3);
        }

        textarea.form-input {
            resize: vertical;
            min-height: 120px;
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            background: #21262D;
            border-radius: 10px;
            height: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #58A6FF 0%, #3FB950 100%);
            transition: width 0.3s ease;
            border-radius: 8px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #161B22 0%, #1C2128 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid #30363D;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .stat-number {
            color: #58A6FF;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7D8590;
            font-size: 14px;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #161B22;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #30363D;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            color: #7D8590;
            font-size: 24px;
            cursor: pointer;
        }

        .close-btn:hover {
            color: #F85149;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 80px 15px 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* éšè—å…ƒç´  */
        .hidden {
            display: none !important;
        }

        /* å¸ƒå±€ */
        .flex {
            display: flex;
        }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .gap-10 {
            gap: 10px;
        }

        .gap-15 {
            gap: 15px;
        }

        .gap-20 {
            gap: 20px;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-15 {
            margin-bottom: 15px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        /* é¢˜ç›®åˆ—è¡¨ */
        .question-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #30363D;
            border-radius: 10px;
            background: #21262D;
        }

        .question-item {
            padding: 15px;
            border-bottom: 1px solid #30363D;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .question-item:hover {
            background: #30363D;
        }

        .question-item.selected {
            background: rgba(88, 166, 255, 0.2);
            border-left: 4px solid #58A6FF;
        }

        .question-item:last-child {
            border-bottom: none;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .question-meta {
            font-size: 15px;
            color: #7D8590;
        }

        /* å¿«æ·é”®æç¤º */
        .shortcuts {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #30363D;
        }

        .shortcut-title {
            color: #7D8590;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .shortcut-item {
            color: #7D8590;
            font-size: 20px;
            margin-bottom: 5px;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #30363D;
        }

        .table th {
            background: #21262D;
            color: #F0F6FC;
            font-weight: bold;
        }

        .table td {
            color: #7D8590;
        }

        .table tr:hover {
            background: rgba(88, 166, 255, 0.1);
        }

        /* åˆ†é¡µ */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .page-btn {
            padding: 8px 12px;
            background: transparent;
            color: #58A6FF;
            border: 1px solid #58A6FF;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover,
        .page-btn.active {
            background: #58A6FF;
            color: white;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- æ ‡é¢˜æ  -->
    <div class="title-bar">
        <div class="title-text">ğŸ§  å…«è‚¡æ–‡å¤ä¹ ç³»ç»Ÿ</div>
        <div class="user-info">Welcome, javaminus!</div>
    </div>

    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <button class="nav-button active" data-page="review">ğŸ¯ å¼€å§‹å¤ä¹ </button>
            <button class="nav-button" data-page="manage">ğŸ“š é¢˜ç›®ç®¡ç†</button>
            <button class="nav-button" data-page="statistics">ğŸ“Š ç»Ÿè®¡åˆ†æ</button>
            <button class="nav-button" data-page="settings">âš™ï¸ è®¾ç½®</button>
            
            <div class="shortcuts">
                <div class="shortcut-title">ğŸ’¡ å¿«æ·é”®</div>
                <div class="shortcut-item">Space - è¯­éŸ³å›ç­”</div>
                <div class="shortcut-item">Enter - æäº¤ç­”æ¡ˆ</div>
                <div class="shortcut-item">â†’ - ä¸‹ä¸€é¢˜</div>
                <div class="shortcut-item">â† - ä¸Šä¸€é¢˜</div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- å¤ä¹ é¡µé¢ -->
            <div id="review-page" class="page">
                <!-- è¿›åº¦åŒºåŸŸ -->
                <div class="card">
                    <div class="flex-between mb-15">
                        <div id="progress-text">é¢˜ç›® 1 / 0</div>
                        <div class="flex gap-10">
                            <button class="btn-secondary" onclick="showHint()">ğŸ’¡ æç¤º</button>
                            <button class="btn-secondary" onclick="readQuestion()">ğŸ”Š æœ—è¯»</button>
                            <button class="btn-secondary" id="mode-btn" onclick="toggleMode()">ğŸ“‘ é¡ºåº</button>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>

                <!-- é¢˜ç›®æ˜¾ç¤ºåŒºåŸŸ -->
                <div class="question-card fade-in">
                    <div class="question-text" id="question-text">
                        æ¬¢è¿ä½¿ç”¨å…«è‚¡æ–‡å¤ä¹ ç³»ç»Ÿï¼è¯·å…ˆæ·»åŠ ä¸€äº›é¢˜ç›®å¼€å§‹å¤ä¹ ã€‚
                    </div>
                </div>

                <!-- ç­”é¢˜åŒºåŸŸ -->
                <div class="card">
                    <div class="flex-center gap-20 mb-20">
                        <button class="voice-btn" id="voice-btn" onclick="toggleVoiceRecording()">ğŸ¤</button>
                        <span style="color: #7D8590;">æˆ–</span>
                        <button class="btn-secondary" onclick="focusAnswerArea()">ğŸ“ æ–‡æœ¬å›ç­”</button>
                    </div>
                    
                    <textarea id="answer-area" class="form-input mb-20" placeholder="è¯·è¾“å…¥æ‚¨çš„ç­”æ¡ˆ..." rows="8"></textarea>
                    
                    <div class="flex-between">
                        <div class="flex gap-15">
                            <button class="btn-primary" onclick="submitAnswer()">æäº¤ç­”æ¡ˆ</button>
                            <button class="btn-secondary" onclick="showAnswer()">æŸ¥çœ‹ç­”æ¡ˆ</button>
                        </div>
                        <div class="flex gap-10">
                            <button class="btn-secondary" onclick="previousQuestion()">â† ä¸Šä¸€é¢˜</button>
                            <button class="btn-primary" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â†’</button>
                        </div>
                    </div>
                </div>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="correct-count">0</div>
                        <div class="stat-label">ç­”å¯¹é¢˜æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-count">0</div>
                        <div class="stat-label">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="accuracy-rate">0%</div>
                        <div class="stat-label">æ­£ç¡®ç‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="time-spent">00:00</div>
                        <div class="stat-label">ç”¨æ—¶</div>
                    </div>
                </div>
            </div>

            <!-- é¢˜ç›®ç®¡ç†é¡µé¢ -->
            <div id="manage-page" class="page hidden">
                <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px;">
                    <!-- å·¦ä¾§é¢˜ç›®åˆ—è¡¨ -->
                    <div class="card">
                        <div class="flex-between mb-20">
                            <h3>ğŸ“š é¢˜ç›®åˆ—è¡¨</h3>
                            <button class="btn-primary" onclick="addNewQuestion()">â• æ·»åŠ é¢˜ç›®</button>
                        </div>
                        <div class="question-list" id="question-list">
                            <!-- é¢˜ç›®åˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- å³ä¾§é¢˜ç›®è¯¦æƒ… -->
                    <div class="card">
                        <h3 class="mb-20">ğŸ“ é¢˜ç›®è¯¦æƒ…</h3>
                        
                        <div class="flex gap-15 mb-15">
                            <div style="flex: 1;">
                                <label style="color: #F0F6FC; display: block; margin-bottom: 5px;">åˆ†ç±»:</label>
                                <input type="text" id="question-category" class="form-input" placeholder="åˆ†ç±»">
                            </div>
                            <div style="flex: 1;">
                                <label style="color: #F0F6FC; display: block; margin-bottom: 5px;">éš¾åº¦:</label>
                                <select id="question-difficulty" class="form-input">
                                    <option value="EASY">ç®€å•</option>
                                    <option value="MEDIUM">ä¸­ç­‰</option>
                                    <option value="HARD">å›°éš¾</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-15">
                            <label style="color: #F0F6FC; display: block; margin-bottom: 5px;">é¢˜ç›®æ ‡é¢˜:</label>
                            <input type="text" id="question-title" class="form-input" placeholder="è¯·è¾“å…¥é¢˜ç›®æ ‡é¢˜">
                        </div>
                        
                        <div class="mb-15">
                            <label style="color: #F0F6FC; display: block; margin-bottom: 5px;">é¢˜ç›®å†…å®¹:</label>
                            <textarea id="question-content" class="form-input" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹" rows="6"></textarea>
                        </div>
                        
                        <div class="mb-20">
                            <label style="color: #F0F6FC; display: block; margin-bottom: 5px;">æç¤ºå†…å®¹:</label>
                            <textarea id="question-hint" class="form-input" placeholder="è¯·è¾“å…¥æç¤ºå†…å®¹" rows="3"></textarea>
                        </div>
                        
                        <div class="flex gap-15">
                            <button class="btn-primary" onclick="saveQuestion()">ğŸ’¾ ä¿å­˜</button>
                            <button class="btn-danger" onclick="deleteQuestion()">ğŸ—‘ï¸ åˆ é™¤</button>
                            <button class="btn-secondary" onclick="editAnswer()">ğŸ“„ ç¼–è¾‘ç­”æ¡ˆ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡åˆ†æé¡µé¢ -->
            <div id="statistics-page" class="page hidden">
                <h2 class="mb-20">ğŸ“Š å­¦ä¹ ç»Ÿè®¡</h2>
                
                <!-- æ€»ä½“ç»Ÿè®¡ -->
                <div class="card mb-20">
                    <h3 class="mb-15">ğŸ“ˆ æ€»ä½“ç»Ÿè®¡</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="stats-total-questions">0</div>
                            <div class="stat-label">æ€»é¢˜ç›®æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="stats-practiced">0</div>
                            <div class="stat-label">å·²ç»ƒä¹ </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="stats-accuracy">0%</div>
                            <div class="stat-label">æ€»æ­£ç¡®ç‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="stats-total-time">0åˆ†é’Ÿ</div>
                            <div class="stat-label">æ€»ç”¨æ—¶</div>
                        </div>
                    </div>
                </div>

                <!-- æœ€è¿‘ç»ƒä¹ è®°å½• -->
                <div class="card">
                    <h3 class="mb-15">ğŸ“‹ æœ€è¿‘ç»ƒä¹ è®°å½•</h3>
                    <table class="table" id="review-records-table">
                        <thead>
                            <tr>
                                <th>é¢˜ç›®</th>
                                <th>ç»“æœ</th>
                                <th>ç”¨æ—¶</th>
                                <th>æ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody id="review-records">
                            <!-- è®°å½•åŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                    
                    <div class="pagination" id="records-pagination">
                        <!-- åˆ†é¡µæŒ‰é’®åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- è®¾ç½®é¡µé¢ -->
            <div id="settings-page" class="page hidden">
                <h2 class="mb-20">âš™ï¸ ç³»ç»Ÿè®¾ç½®</h2>
                
                <!-- ä¸»é¢˜è®¾ç½® -->
                <div class="card mb-20">
                    <h3 class="mb-15">ğŸ¨ ä¸»é¢˜è®¾ç½®</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="stat-card" onclick="setTheme('dark')" style="cursor: pointer;">
                            <div style="color: #58A6FF; font-weight: bold;">æš—é»‘ç§‘æŠ€é£</div>
                            <div style="font-size: 12px; margin-top: 5px;">å½“å‰ä¸»é¢˜</div>
                        </div>
                        <div class="stat-card" onclick="setTheme('purple')" style="cursor: pointer;">
                            <div style="color: #7209B7; font-weight: bold;">æå®¢ç´«è‰²é£</div>
                            <div style="font-size: 12px; margin-top: 5px;">ç‚¹å‡»åˆ‡æ¢</div>
                        </div>
                        <div class="stat-card" onclick="setTheme('blue')" style="cursor: pointer;">
                            <div style="color: #0969DA; font-weight: bold;">ç»å…¸è“è‰²é£</div>
                            <div style="font-size: 12px; margin-top: 5px;">ç‚¹å‡»åˆ‡æ¢</div>
                        </div>
                    </div>
                </div>

                <!-- è¯­éŸ³è®¾ç½® -->
                <div class="card mb-20">
                    <h3 class="mb-15">ğŸ”Š è¯­éŸ³è®¾ç½®</h3>
                    <div style="display: grid; gap: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enable-tts" checked>
                            <span>å¯ç”¨æ–‡å­—è½¬è¯­éŸ³</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="enable-asr" checked>
                            <span>å¯ç”¨è¯­éŸ³è¯†åˆ«</span>
                        </label>
                        <div>
                            <label style="color: #F0F6FC; display: block; margin-bottom: 5px;">è¯­éŸ³é€Ÿåº¦:</label>
                            <input type="range" id="speech-rate" min="0.5" max="2" step="0.1" value="1" style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- æ•°æ®ç®¡ç† -->
                <div class="card">
                    <h3 class="mb-15">ğŸ’¾ æ•°æ®ç®¡ç†</h3>
                    <div class="flex gap-15">
                        <button class="btn-secondary" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                        <button class="btn-secondary" onclick="importData()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
                        <button class="btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">æ ‡é¢˜</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body">
                <!-- æ¨¡æ€æ¡†å†…å®¹ -->
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let questions = [];
        let currentQuestionIndex = 0;
        let isRandomMode = false;
        let reviewRecords = [];
        let sessionStats = {
            correctAnswers: 0,
            totalAnswered: 0,
            startTime: Date.now()
        };
        let selectedQuestionId = null;
        let isRecording = false;
        let speechSynthesis = window.speechSynthesis;
        let speechRecognition = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initSpeechRecognition();
            loadData();
            initEventListeners();
            showCurrentQuestion();
            updateStats();
            startTimeUpdate();
            
            // æ·»åŠ ç¤ºä¾‹æ•°æ®
            if (questions.length === 0) {
                addSampleQuestions();
            }
        });

        // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                speechRecognition = new webkitSpeechRecognition();
                speechRecognition.continuous = false;
                speechRecognition.interimResults = false;
                speechRecognition.lang = 'zh-CN';
                
                speechRecognition.onresult = function(event) {
                    const result = event.results[0][0].transcript;
                    document.getElementById('answer-area').value = result;
                    stopRecording();
                };
                
                speechRecognition.onerror = function(event) {
                    console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
                    stopRecording();
                    showAlert('è¯­éŸ³è¯†åˆ«å¤±è´¥', 'è¯·æ£€æŸ¥éº¦å…‹é£æƒé™æˆ–é‡è¯•');
                };
            }
        }

        // æ·»åŠ ç¤ºä¾‹æ•°æ®
        function addSampleQuestions() {
            const sampleQuestions = [
                {
                    id: generateId(),
                    title: "ä»€ä¹ˆæ˜¯Javaè™šæ‹Ÿæœº(JVM)ï¼Ÿ",
                    content: "è¯·è¯¦ç»†è§£é‡ŠJavaè™šæ‹Ÿæœº(JVM)çš„ä½œç”¨ã€ç»„æˆéƒ¨åˆ†ä»¥åŠå·¥ä½œåŸç†ã€‚åŒ…æ‹¬å†…å­˜ç®¡ç†ã€å­—èŠ‚ç æ‰§è¡Œã€åƒåœ¾å›æ”¶ç­‰æ–¹é¢ã€‚",
                    hint: "ä»å†…å­˜ç®¡ç†ã€å­—èŠ‚ç æ‰§è¡Œã€åƒåœ¾å›æ”¶ç­‰è§’åº¦è€ƒè™‘",
                    answer: "Javaè™šæ‹Ÿæœº(JVM)æ˜¯Javaç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œå®ƒçš„ä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼š\n\n1. **å­—èŠ‚ç æ‰§è¡Œ**: JVMè´Ÿè´£æ‰§è¡ŒJavaç¼–è¯‘å™¨ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶(.class)\n\n2. **å†…å­˜ç®¡ç†**: \n   - å †å†…å­˜ï¼šå­˜å‚¨å¯¹è±¡å®ä¾‹\n   - æ–¹æ³•åŒºï¼šå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡æ± \n   - æ ˆå†…å­˜ï¼šå­˜å‚¨å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨\n   - PCå¯„å­˜å™¨ï¼šå­˜å‚¨å½“å‰æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€\n\n3. **åƒåœ¾å›æ”¶**: è‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜ç©ºé—´\n\n4. **å¹³å°æ— å…³æ€§**: å®ç°'ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ'çš„ç‰¹æ€§\n\n5. **å®‰å…¨æ€§**: æä¾›å®‰å…¨æ£€æŸ¥æœºåˆ¶ï¼Œé˜²æ­¢æ¶æ„ä»£ç æ‰§è¡Œ",
                    category: "JavaåŸºç¡€",
                    difficulty: "MEDIUM",
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    title: "Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†",
                    content: "Spring Bootæ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨é…ç½®çš„ï¼Ÿè¯·ä»æºç è§’åº¦åˆ†æ@EnableAutoConfigurationæ³¨è§£çš„å·¥ä½œæœºåˆ¶ã€‚",
                    hint: "è€ƒè™‘@EnableAutoConfigurationæ³¨è§£å’Œspring.factoriesæ–‡ä»¶çš„ä½œç”¨",
                    answer: "Spring Bootè‡ªåŠ¨é…ç½®åŸç†ï¼š\n\n1. **@EnableAutoConfigurationæ³¨è§£**:\n   - é€šè¿‡@Import(AutoConfigurationImportSelector.class)å¯¼å…¥é…ç½®\n   - AutoConfigurationImportSelectorè¯»å–META-INF/spring.factoriesæ–‡ä»¶\n\n2. **spring.factoriesæ–‡ä»¶**:\n   - å®šä¹‰äº†æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»\n   - æ ¼å¼ï¼šorg.springframework.boot.autoconfigure.EnableAutoConfiguration=é…ç½®ç±»åˆ—è¡¨\n\n3. **è‡ªåŠ¨é…ç½®ç±»ç‰¹ç‚¹**:\n   - ä½¿ç”¨@Configurationæ³¨è§£\n   - ä½¿ç”¨@ConditionalOnXxxæ³¨è§£è¿›è¡Œæ¡ä»¶åˆ¤æ–­\n   - åªæœ‰æ»¡è¶³æ¡ä»¶æ‰ä¼šç”Ÿæ•ˆ\n\n4. **å¸¸è§çš„æ¡ä»¶æ³¨è§£**:\n   - @ConditionalOnClassï¼šç±»è·¯å¾„å­˜åœ¨æŸä¸ªç±»\n   - @ConditionalOnMissingBeanï¼šå®¹å™¨ä¸­ä¸å­˜åœ¨æŸä¸ªBean\n   - @ConditionalOnPropertyï¼šé…ç½®å±æ€§æ»¡è¶³æ¡ä»¶\n\n5. **é…ç½®ä¼˜å…ˆçº§**:\n   - ç”¨æˆ·è‡ªå®šä¹‰é…ç½® > è‡ªåŠ¨é…ç½®",
                    category: "Springæ¡†æ¶",
                    difficulty: "HARD",
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    title: "MySQLçš„ACIDç‰¹æ€§",
                    content: "è¯·è¯¦ç»†è§£é‡Šæ•°æ®åº“äº‹åŠ¡çš„ACIDç‰¹æ€§ï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜æ¯ä¸ªç‰¹æ€§çš„é‡è¦æ€§ã€‚",
                    hint: "åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§",
                    answer: "MySQLçš„ACIDç‰¹æ€§ï¼š\n\n1. **åŸå­æ€§(Atomicity)**:\n   - äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°å·¥ä½œå•ä½\n   - è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»š\n   - ä¾‹ï¼šè½¬è´¦æ“ä½œï¼Œæ‰£æ¬¾å’Œå…¥è´¦å¿…é¡»åŒæ—¶æˆåŠŸæˆ–å¤±è´¥\n\n2. **ä¸€è‡´æ€§(Consistency)**:\n   - äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€\n   - ä¾‹ï¼šè½¬è´¦å‰åï¼Œä¸¤ä¸ªè´¦æˆ·ä½™é¢æ€»å’Œä¸å˜\n\n3. **éš”ç¦»æ€§(Isolation)**:\n   - å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¹‹é—´ä¸èƒ½ç›¸äº’å¹²æ‰°\n   - é€šè¿‡é”æœºåˆ¶å’ŒMVCCå®ç°\n   - éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤ã€è¯»å·²æäº¤ã€å¯é‡å¤è¯»ã€ä¸²è¡ŒåŒ–\n\n4. **æŒä¹…æ€§(Durability)**:\n   - äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„\n   - é€šè¿‡redo logç¡®ä¿å³ä½¿ç³»ç»Ÿå´©æºƒä¹Ÿèƒ½æ¢å¤\n\n**å®ç°æœºåˆ¶**:\n- undo logä¿è¯åŸå­æ€§å’Œä¸€è‡´æ€§\n- é”æœºåˆ¶å’ŒMVCCä¿è¯éš”ç¦»æ€§\n- redo logä¿è¯æŒä¹…æ€§",
                    category: "æ•°æ®åº“",
                    difficulty: "MEDIUM",
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    title: "HashMap vs ConcurrentHashMap",
                    content: "è¯·å¯¹æ¯”HashMapå’ŒConcurrentHashMapçš„å®ç°åŸç†ã€æ•°æ®ç»“æ„å’Œä½¿ç”¨åœºæ™¯ï¼Œåˆ†æå®ƒä»¬åœ¨çº¿ç¨‹å®‰å…¨æ–¹é¢çš„å·®å¼‚ã€‚",
                    hint: "çº¿ç¨‹å®‰å…¨ã€æ•°æ®ç»“æ„ã€æ€§èƒ½å·®å¼‚",
                    answer: "HashMap vs ConcurrentHashMapå¯¹æ¯”ï¼š\n\n**HashMap**:\n1. **çº¿ç¨‹å®‰å…¨æ€§**: éçº¿ç¨‹å®‰å…¨\n2. **æ•°æ®ç»“æ„**: æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘(JDK8+)\n3. **æ€§èƒ½**: å•çº¿ç¨‹ç¯å¢ƒä¸‹æ€§èƒ½æœ€ä¼˜\n4. **æ‰©å®¹**: éçº¿ç¨‹å®‰å…¨ï¼Œå¯èƒ½å¯¼è‡´æ­»å¾ªç¯\n\n**ConcurrentHashMap**:\n1. **çº¿ç¨‹å®‰å…¨æ€§**: çº¿ç¨‹å®‰å…¨\n2. **å®ç°åŸç†**:\n   - JDK7: åˆ†æ®µé”(Segment)\n   - JDK8: CAS + synchronized\n3. **æ•°æ®ç»“æ„**: ä¸HashMapç±»ä¼¼ï¼Œä½†åŠ å…¥äº†å¹¶å‘æ§åˆ¶\n4. **æ‰©å®¹**: æ”¯æŒå¹¶å‘æ‰©å®¹ï¼Œå¤šçº¿ç¨‹ååŠ©è¿ç§»\n\n**ä¸»è¦åŒºåˆ«**:\n1. **é”ç²’åº¦**: ConcurrentHashMapé”ç²’åº¦æ›´ç»†\n2. **æ€§èƒ½**: \n   - å•çº¿ç¨‹: HashMap > ConcurrentHashMap\n   - å¤šçº¿ç¨‹: ConcurrentHashMap > HashMap\n3. **ä½¿ç”¨åœºæ™¯**:\n   - HashMap: å•çº¿ç¨‹æˆ–æ˜ç¡®æ— å¹¶å‘è®¿é—®\n   - ConcurrentHashMap: å¤šçº¿ç¨‹å¹¶å‘è®¿é—®\n\n**ConcurrentHashMapä¼˜åŒ–**:\n- è¯»æ“ä½œå‡ ä¹æ— é”\n- å†™æ“ä½œä½¿ç”¨CASå’Œå±€éƒ¨é”\n- æ”¯æŒå¹¶å‘æ‰©å®¹",
                    category: "Javaé›†åˆ",
                    difficulty: "HARD",
                    createdAt: new Date().toISOString()
                },
                {
                    id: generateId(),
                    title: "RedisæŒä¹…åŒ–æœºåˆ¶",
                    content: "Redisæœ‰å“ªäº›æŒä¹…åŒ–æ–¹å¼ï¼Ÿè¯·è¯¦ç»†è¯´æ˜RDBå’ŒAOFçš„å·¥ä½œåŸç†ã€ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚",
                    hint: "RDBå’ŒAOFä¸¤ç§æ–¹å¼ï¼Œè€ƒè™‘æ€§èƒ½å’Œæ•°æ®å®‰å…¨æ€§",
                    answer: "RedisæŒä¹…åŒ–æœºåˆ¶ï¼š\n\n**1. RDB(Redis Database)**:\n- **åŸç†**: åœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…ç”Ÿæˆæ•°æ®é›†çš„æ—¶é—´ç‚¹å¿«ç…§\n- **è§¦å‘æ–¹å¼**:\n  - æ‰‹åŠ¨: SAVEã€BGSAVEå‘½ä»¤\n  - è‡ªåŠ¨: é…ç½®saveè§„åˆ™\n- **ä¼˜ç‚¹**:\n  - æ–‡ä»¶ç´§å‡‘ï¼Œé€‚åˆå¤‡ä»½\n  - æ¢å¤é€Ÿåº¦å¿«\n  - å¯¹æ€§èƒ½å½±å“å°\n- **ç¼ºç‚¹**:\n  - æ•°æ®ä¸¢å¤±é£é™©å¤§\n  - forkå­è¿›ç¨‹æ—¶ä¼šé˜»å¡\n\n**2. AOF(Append Only File)**:\n- **åŸç†**: è®°å½•æ¯ä¸ªå†™æ“ä½œå‘½ä»¤\n- **åŒæ­¥ç­–ç•¥**:\n  - always: æ¯ä¸ªå‘½ä»¤éƒ½åŒæ­¥\n  - everysec: æ¯ç§’åŒæ­¥ä¸€æ¬¡\n  - no: ç”±æ“ä½œç³»ç»Ÿå†³å®š\n- **ä¼˜ç‚¹**:\n  - æ•°æ®å®‰å…¨æ€§é«˜\n  - æ–‡ä»¶å¯è¯»ï¼Œä¾¿äºç†è§£\n  - æ”¯æŒé‡å†™å‹ç¼©\n- **ç¼ºç‚¹**:\n  - æ–‡ä»¶ä½“ç§¯å¤§\n  - æ¢å¤é€Ÿåº¦æ…¢\n  - æ€§èƒ½å¼€é”€å¤§\n\n**3. æ··åˆæŒä¹…åŒ–(Redis 4.0+)**:\n- ç»“åˆRDBå’ŒAOFçš„ä¼˜ç‚¹\n- AOFé‡å†™æ—¶ä½¿ç”¨RDBæ ¼å¼å†™å…¥\n- å…¼é¡¾æ€§èƒ½å’Œæ•°æ®å®‰å…¨\n\n**é€‰æ‹©å»ºè®®**:\n- é«˜æ€§èƒ½è¦æ±‚: RDB\n- é«˜æ•°æ®å®‰å…¨: AOF\n- å¹³è¡¡è€ƒè™‘: æ··åˆæŒä¹…åŒ–",
                    category: "Redis",
                    difficulty: "MEDIUM",
                    createdAt: new Date().toISOString()
                }
            ];

            questions = sampleQuestions;
            saveData();
            updateQuestionList();
            showCurrentQuestion();
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // å¯¼èˆªæŒ‰é’®
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = this.dataset.page;
                    showPage(page);
                    
                    // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                    document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }

                switch(e.code) {
                    case 'Space':
                        e.preventDefault();
                        toggleVoiceRecording();
                        break;
                    case 'Enter':
                        e.preventDefault();
                        submitAnswer();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        nextQuestion();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        previousQuestion();
                        break;
                }
            });

            // ç­”æ¡ˆåŒºåŸŸå›è½¦æäº¤
            document.getElementById('answer-area').addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    submitAnswer();
                }
            });
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            const targetPage = document.getElementById(pageName + '-page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');
                
                // ç‰¹å®šé¡µé¢çš„åˆå§‹åŒ–
                if (pageName === 'manage') {
                    updateQuestionList();
                } else if (pageName === 'statistics') {
                    updateStatistics();
                }
            }
        }

        // æ•°æ®æ“ä½œ
        function loadData() {
            const savedQuestions = localStorage.getItem('baguwen_questions');
            const savedRecords = localStorage.getItem('baguwen_records');
            
            if (savedQuestions) {
                questions = JSON.parse(savedQuestions);
            }
            
            if (savedRecords) {
                reviewRecords = JSON.parse(savedRecords);
            }
        }

        function saveData() {
            localStorage.setItem('baguwen_questions', JSON.stringify(questions));
            localStorage.setItem('baguwen_records', JSON.stringify(reviewRecords));
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // å¤ä¹ åŠŸèƒ½
        function showCurrentQuestion() {
            if (questions.length === 0) {
                document.getElementById('question-text').textContent = 'æš‚æ— é¢˜ç›®ï¼Œè¯·å…ˆæ·»åŠ ä¸€äº›é¢˜ç›®å¼€å§‹å¤ä¹ ã€‚';
                document.getElementById('progress-text').textContent = 'é¢˜ç›® 0 / 0';
                document.getElementById('progress-bar').style.width = '0%';
                return;
            }

            if (currentQuestionIndex >= questions.length) {
                currentQuestionIndex = 0;
            }

            const current = questions[currentQuestionIndex];
            document.getElementById('question-text').textContent = current.content;
            document.getElementById('progress-text').textContent = `é¢˜ç›® ${currentQuestionIndex + 1} / ${questions.length}`;
            document.getElementById('progress-bar').style.width = `${((currentQuestionIndex + 1) / questions.length) * 100}%`;
            
            // æ¸…ç©ºç­”æ¡ˆ
            document.getElementById('answer-area').value = '';
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            const questionElement = document.getElementById('question-text');
            questionElement.style.opacity = '0';
            setTimeout(() => {
                questionElement.style.opacity = '1';
            }, 100);
        }

        function nextQuestion() {
            if (questions.length === 0) return;
            
            if (isRandomMode) {
                currentQuestionIndex = Math.floor(Math.random() * questions.length);
            } else {
                currentQuestionIndex = (currentQuestionIndex + 1) % questions.length;
            }
            showCurrentQuestion();
        }

        function previousQuestion() {
            if (questions.length === 0) return;
            
            if (isRandomMode) {
                currentQuestionIndex = Math.floor(Math.random() * questions.length);
            } else {
                currentQuestionIndex = currentQuestionIndex > 0 ? currentQuestionIndex - 1 : questions.length - 1;
            }
            showCurrentQuestion();
        }

        function toggleMode() {
            isRandomMode = !isRandomMode;
            const modeBtn = document.getElementById('mode-btn');
            modeBtn.textContent = isRandomMode ? 'ğŸ”€ éšæœº' : 'ğŸ“‘ é¡ºåº';
            
            // åŠ¨ç”»æ•ˆæœ
            modeBtn.style.transform = 'scale(1.1)';
            setTimeout(() => {
                modeBtn.style.transform = 'scale(1)';
            }, 200);
        }

        function submitAnswer() {
            const answerText = document.getElementById('answer-area').value.trim();
            if (!answerText) {
                showAlert('æç¤º', 'è¯·å…ˆè¾“å…¥ç­”æ¡ˆï¼');
                return;
            }

            if (questions.length === 0) return;

            // å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
            const isCorrect = confirm('è¯·ç¡®è®¤æ‚¨çš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ï¼Ÿ\n\nç‚¹å‡»"ç¡®å®š"è¡¨ç¤ºæ­£ç¡®ï¼Œ"å–æ¶ˆ"è¡¨ç¤ºé”™è¯¯ã€‚');
            
            // è®°å½•ç­”é¢˜ç»“æœ
            recordAnswer(answerText, isCorrect);
            
            if (isCorrect) {
                sessionStats.correctAnswers++;
                // åŠ¨ç”»æ•ˆæœ
                const correctCountElement = document.getElementById('correct-count');
                correctCountElement.style.transform = 'scale(1.2)';
                correctCountElement.style.color = '#3FB950';
                setTimeout(() => {
                    correctCountElement.style.transform = 'scale(1)';
                    correctCountElement.style.color = '#58A6FF';
                }, 300);
            }
            
            sessionStats.totalAnswered++;
            updateStats();
        }

        function recordAnswer(answerText, isCorrect) {
            if (questions.length === 0) return;
            
            const current = questions[currentQuestionIndex];
            const record = {
                id: generateId(),
                questionId: current.id,
                questionTitle: current.title,
                userAnswer: answerText,
                isCorrect: isCorrect,
                reviewTime: new Date().toLocaleString(),
                timeSpent: Math.floor((Date.now() - sessionStats.startTime) / 1000)
            };
            
            reviewRecords.unshift(record);
            
            // åªä¿ç•™æœ€è¿‘1000æ¡è®°å½•
            if (reviewRecords.length > 1000) {
                reviewRecords = reviewRecords.slice(0, 1000);
            }
            
            saveData();
        }

        function showAnswer() {
            if (questions.length === 0) return;
            
            const current = questions[currentQuestionIndex];
            showModal('æ ‡å‡†ç­”æ¡ˆ - ' + current.title, `<div style="white-space: pre-line; line-height: 1.6;">${current.answer}</div>`);
        }

        function showHint() {
            if (questions.length === 0) return;
            
            const current = questions[currentQuestionIndex];
            if (current.hint) {
                showAlert('ğŸ’¡ æç¤º', current.hint);
            } else {
                showAlert('æç¤º', 'è¯¥é¢˜ç›®æš‚æ— æç¤ºã€‚');
            }
        }

        function readQuestion() {
            if (questions.length === 0) return;
            
            const current = questions[currentQuestionIndex];
            speakText(current.content);
        }

        function focusAnswerArea() {
            document.getElementById('answer-area').focus();
        }

        // è¯­éŸ³åŠŸèƒ½
        function toggleVoiceRecording() {
            if (!speechRecognition) {
                showAlert('ä¸æ”¯æŒ', 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½');
                return;
            }

            if (!document.getElementById('enable-asr').checked) {
                showAlert('æç¤º', 'è¯­éŸ³è¯†åˆ«åŠŸèƒ½å·²ç¦ç”¨ï¼Œè¯·åœ¨è®¾ç½®ä¸­å¯ç”¨');
                return;
            }

            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            const voiceBtn = document.getElementById('voice-btn');
            voiceBtn.classList.add('recording');
            voiceBtn.textContent = 'ğŸ™ï¸';
            isRecording = true;
            
            try {
                speechRecognition.start();
            } catch (error) {
                console.error('å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥:', error);
                stopRecording();
            }
        }

        function stopRecording() {
            const voiceBtn = document.getElementById('voice-btn');
            voiceBtn.classList.remove('recording');
            voiceBtn.textContent = 'ğŸ¤';
            isRecording = false;
            
            if (speechRecognition) {
                speechRecognition.stop();
            }
        }

        function speakText(text) {
            if (!document.getElementById('enable-tts').checked) {
                showAlert('æç¤º', 'è¯­éŸ³æœ—è¯»åŠŸèƒ½å·²ç¦ç”¨ï¼Œè¯·åœ¨è®¾ç½®ä¸­å¯ç”¨');
                return;
            }

            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
                return;
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-CN';
            utterance.rate = parseFloat(document.getElementById('speech-rate').value);
            
            speechSynthesis.speak(utterance);
        }

        // é¢˜ç›®ç®¡ç†
        function updateQuestionList() {
            const listElement = document.getElementById('question-list');
            listElement.innerHTML = '';
            
            questions.forEach(question => {
                const item = document.createElement('div');
                item.className = 'question-item';
                item.onclick = () => selectQuestion(question.id);
                
                if (selectedQuestionId === question.id) {
                    item.classList.add('selected');
                }
                
                item.innerHTML = `
                    <div class="question-title">${question.title}</div>
                    <div class="question-meta">${question.category || 'æœªåˆ†ç±»'} | ${getDifficultyText(question.difficulty)} | ${new Date(question.createdAt).toLocaleDateString()}</div>
                `;
                
                listElement.appendChild(item);
            });
        }

        function selectQuestion(questionId) {
            selectedQuestionId = questionId;
            const question = questions.find(q => q.id === questionId);
            
            if (question) {
                document.getElementById('question-title').value = question.title;
                document.getElementById('question-content').value = question.content;
                document.getElementById('question-hint').value = question.hint || '';
                document.getElementById('question-category').value = question.category || '';
                document.getElementById('question-difficulty').value = question.difficulty;
            }
            
            updateQuestionList();
        }

        function addNewQuestion() {
            selectedQuestionId = null;
            document.getElementById('question-title').value = '';
            document.getElementById('question-content').value = '';
            document.getElementById('question-hint').value = '';
            document.getElementById('question-category').value = '';
            document.getElementById('question-difficulty').value = 'MEDIUM';
            document.getElementById('question-title').focus();
            updateQuestionList();
        }

        function saveQuestion() {
            const title = document.getElementById('question-title').value.trim();
            const content = document.getElementById('question-content').value.trim();
            const hint = document.getElementById('question-hint').value.trim();
            const category = document.getElementById('question-category').value.trim();
            const difficulty = document.getElementById('question-difficulty').value;
            
            if (!title || !content) {
                showAlert('é”™è¯¯', 'é¢˜ç›®æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }
            
            if (selectedQuestionId) {
                // æ›´æ–°ç°æœ‰é¢˜ç›®
                const questionIndex = questions.findIndex(q => q.id === selectedQuestionId);
                if (questionIndex !== -1) {
                    questions[questionIndex] = {
                        ...questions[questionIndex],
                        title,
                        content,
                        hint,
                        category,
                        difficulty,
                        updatedAt: new Date().toISOString()
                    };
                }
            } else {
                // æ·»åŠ æ–°é¢˜ç›®
                const newQuestion = {
                    id: generateId(),
                    title,
                    content,
                    hint,
                    answer: `è¿™é‡Œæ˜¯ "${title}" çš„æ ‡å‡†ç­”æ¡ˆã€‚\n\nè¯·ç¼–è¾‘æ­¤ç­”æ¡ˆå†…å®¹...`,
                    category,
                    difficulty,
                    createdAt: new Date().toISOString()
                };
                questions.unshift(newQuestion);
                selectedQuestionId = newQuestion.id;
            }
            
            saveData();
            updateQuestionList();
            showAlert('æˆåŠŸ', 'é¢˜ç›®ä¿å­˜æˆåŠŸï¼');
            
            // å¦‚æœå½“å‰åœ¨å¤ä¹ é¡µé¢ï¼Œæ›´æ–°é¢˜ç›®æ˜¾ç¤º
            if (!document.getElementById('review-page').classList.contains('hidden')) {
                showCurrentQuestion();
            }
        }

        function deleteQuestion() {
            if (!selectedQuestionId) {
                showAlert('æç¤º', 'è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¢˜ç›®ï¼');
                return;
            }
            
            const question = questions.find(q => q.id === selectedQuestionId);
            if (!question) return;
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤é¢˜ç›® "${question.title}" å—ï¼Ÿ`)) {
                questions = questions.filter(q => q.id !== selectedQuestionId);
                reviewRecords = reviewRecords.filter(r => r.questionId !== selectedQuestionId);
                
                saveData();
                addNewQuestion();
                showAlert('æˆåŠŸ', 'é¢˜ç›®åˆ é™¤æˆåŠŸï¼');
                
                // å¦‚æœå½“å‰é¢˜ç›®è¢«åˆ é™¤ï¼Œé‡ç½®ç´¢å¼•
                if (currentQuestionIndex >= questions.length) {
                    currentQuestionIndex = 0;
                }
                showCurrentQuestion();
            }
        }

        function editAnswer() {
            if (!selectedQuestionId) {
                showAlert('æç¤º', 'è¯·å…ˆé€‰æ‹©é¢˜ç›®ï¼');
                return;
            }
            
            const question = questions.find(q => q.id === selectedQuestionId);
            if (!question) return;
            
            const newAnswer = prompt('è¯·ç¼–è¾‘ç­”æ¡ˆ:', question.answer);
            if (newAnswer !== null) {
                question.answer = newAnswer;
                saveData();
                showAlert('æˆåŠŸ', 'ç­”æ¡ˆä¿å­˜æˆåŠŸï¼');
            }
        }

        // ç»Ÿè®¡åŠŸèƒ½
        function updateStats() {
            // å¤ä¹ é¡µé¢ç»Ÿè®¡
            document.getElementById('correct-count').textContent = sessionStats.correctAnswers;
            document.getElementById('total-count').textContent = sessionStats.totalAnswered;
            
            const accuracy = sessionStats.totalAnswered > 0 ? 
                (sessionStats.correctAnswers / sessionStats.totalAnswered * 100).toFixed(1) : 0;
            document.getElementById('accuracy-rate').textContent = accuracy + '%';
        }

        function updateStatistics() {
            // æ€»ä½“ç»Ÿè®¡
            document.getElementById('stats-total-questions').textContent = questions.length;
            
            const practicedQuestions = new Set(reviewRecords.map(r => r.questionId)).size;
            document.getElementById('stats-practiced').textContent = practicedQuestions;
            
            const totalCorrect = reviewRecords.filter(r => r.isCorrect).length;
            const totalReviews = reviewRecords.length;
            const overallAccuracy = totalReviews > 0 ? (totalCorrect / totalReviews * 100).toFixed(1) : 0;
            document.getElementById('stats-accuracy').textContent = overallAccuracy + '%';
            
            const totalTime = reviewRecords.reduce((sum, r) => sum + (r.timeSpent || 0), 0);
            document.getElementById('stats-total-time').textContent = Math.floor(totalTime / 60) + 'åˆ†é’Ÿ';
            
            // æ›´æ–°è®°å½•è¡¨
            updateRecordsTable();
        }

        function updateRecordsTable() {
            const tbody = document.getElementById('review-records');
            tbody.innerHTML = '';
            
            const recentRecords = reviewRecords.slice(0, 20);
            
            recentRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${record.questionTitle}">${record.questionTitle}</td>
                    <td>${record.isCorrect ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}</td>
                    <td>${record.timeSpent}ç§’</td>
                    <td>${record.reviewTime}</td>
                `;
                tbody.appendChild(row);
            });
            
            if (recentRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4" style="text-align: center; color: #7D8590;">æš‚æ— ç»ƒä¹ è®°å½•</td>';
                tbody.appendChild(row);
            }
        }

        function startTimeUpdate() {
            setInterval(() => {
                const elapsed = Math.floor((Date.now() - sessionStats.startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('time-spent').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // è®¾ç½®åŠŸèƒ½
        function setTheme(themeName) {
            // è¿™é‡Œå¯ä»¥å®ç°ä¸»é¢˜åˆ‡æ¢é€»è¾‘
            showAlert('ä¸»é¢˜', `å·²åˆ‡æ¢åˆ°${getThemeName(themeName)}ä¸»é¢˜`);
        }

        function getThemeName(theme) {
            const themes = {
                'dark': 'æš—é»‘ç§‘æŠ€é£',
                'purple': 'æå®¢ç´«è‰²é£',
                'blue': 'ç»å…¸è“è‰²é£'
            };
            return themes[theme] || 'æœªçŸ¥ä¸»é¢˜';
        }

        function exportData() {
            const data = {
                questions: questions,
                records: reviewRecords,
                exportTime: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `baguwen_data_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showAlert('æˆåŠŸ', 'æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }

                function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (data.questions && Array.isArray(data.questions)) {
                            if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–ç°æœ‰æ•°æ®ï¼')) {
                                questions = data.questions;
                                if (data.records && Array.isArray(data.records)) {
                                    reviewRecords = data.records;
                                }
                                
                                saveData();
                                updateQuestionList();
                                showCurrentQuestion();
                                updateStatistics();
                                showAlert('æˆåŠŸ', 'æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                            }
                        } else {
                            showAlert('é”™è¯¯', 'æ— æ•ˆçš„æ•°æ®æ ¼å¼ï¼');
                        }
                    } catch (error) {
                        showAlert('é”™è¯¯', 'æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼š' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                questions = [];
                reviewRecords = [];
                sessionStats = {
                    correctAnswers: 0,
                    totalAnswered: 0,
                    startTime: Date.now()
                };
                
                localStorage.removeItem('baguwen_questions');
                localStorage.removeItem('baguwen_records');
                
                currentQuestionIndex = 0;
                selectedQuestionId = null;
                
                updateQuestionList();
                showCurrentQuestion();
                updateStats();
                updateStatistics();
                
                showAlert('æˆåŠŸ', 'æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼');
            }
        }

        // å·¥å…·å‡½æ•°
        function getDifficultyText(difficulty) {
            const difficultyMap = {
                'EASY': 'ç®€å•',
                'MEDIUM': 'ä¸­ç­‰',
                'HARD': 'å›°éš¾'
            };
            return difficultyMap[difficulty] || 'æœªçŸ¥';
        }

        function showAlert(title, message) {
            alert(`${title}ï¼š${message}`);
        }

        function showModal(title, content) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = content;
            document.getElementById('modal').style.display = 'flex';
            
            // æ·»åŠ æ·¡å…¥åŠ¨ç”»
            const modal = document.getElementById('modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // ESCé”®å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('modal').style.display === 'flex') {
                closeModal();
            }
        });

        // é˜²æ­¢é¡µé¢åˆ·æ–°ä¸¢å¤±æ•°æ®çš„æé†’
        window.addEventListener('beforeunload', function(e) {
            if (sessionStats.totalAnswered > 0) {
                e.preventDefault();
                e.returnValue = 'æ‚¨æœ‰æœªä¿å­˜çš„å¤ä¹ è®°å½•ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
            }
        });

        // ç§»åŠ¨ç«¯æ”¯æŒ
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // å‘å·¦æ»‘åŠ¨ - ä¸‹ä¸€é¢˜
                    nextQuestion();
                } else {
                    // å‘å³æ»‘åŠ¨ - ä¸Šä¸€é¢˜
                    previousQuestion();
                }
            }
        }

        // è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
        setInterval(function() {
            saveData();
        }, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡

        // ä¸»é¢˜åˆ‡æ¢å®Œæ•´å®ç°
        function setTheme(themeName) {
            const themes = {
                'dark': {
                    name: 'æš—é»‘ç§‘æŠ€é£',
                    primary: '#58A6FF',
                    secondary: '#7C3AED',
                    background: '#0D1117',
                    cardBg: '#161B22',
                    textColor: '#F0F6FC'
                },
                'purple': {
                    name: 'æå®¢ç´«è‰²é£',
                    primary: '#7209B7',
                    secondary: '#9D4EDD',
                    background: '#1A0B2E',
                    cardBg: '#16213E',
                    textColor: '#EAEAEA'
                },
                'blue': {
                    name: 'ç»å…¸è“è‰²é£',
                    primary: '#0969DA',
                    secondary: '#218BFF',
                    background: '#0D1421',
                    cardBg: '#161B26',
                    textColor: '#F0F6FC'
                }
            };
            
            const theme = themes[themeName];
            if (theme) {
                document.documentElement.style.setProperty('--primary-color', theme.primary);
                document.documentElement.style.setProperty('--secondary-color', theme.secondary);
                document.documentElement.style.setProperty('--bg-color', theme.background);
                document.documentElement.style.setProperty('--card-bg', theme.cardBg);
                document.documentElement.style.setProperty('--text-color', theme.textColor);
                
                localStorage.setItem('baguwen_theme', themeName);
                showAlert('ä¸»é¢˜', `å·²åˆ‡æ¢åˆ°${theme.name}ä¸»é¢˜`);
            }
        }

        // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
        function loadTheme() {
            const savedTheme = localStorage.getItem('baguwen_theme') || 'dark';
            setTheme(savedTheme);
        }

        // åœ¨åˆå§‹åŒ–æ—¶åŠ è½½ä¸»é¢˜
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
        });

        // æœç´¢åŠŸèƒ½
        function searchQuestions(keyword) {
            const filteredQuestions = questions.filter(q => 
                q.title.toLowerCase().includes(keyword.toLowerCase()) ||
                q.content.toLowerCase().includes(keyword.toLowerCase()) ||
                (q.category && q.category.toLowerCase().includes(keyword.toLowerCase()))
            );
            return filteredQuestions;
        }

        // å¤ä¹ æ¨¡å¼æ‰©å±•
        function startQuickReview(count = 10) {
            if (questions.length === 0) {
                showAlert('æç¤º', 'æš‚æ— é¢˜ç›®å¯ä¾›å¤ä¹ ');
                return;
            }
            
            const reviewQuestions = isRandomMode ? 
                shuffleArray([...questions]).slice(0, count) :
                questions.slice(0, count);
            
            // è¿™é‡Œå¯ä»¥å®ç°å¿«é€Ÿå¤ä¹ æ¨¡å¼
            showAlert('å¿«é€Ÿå¤ä¹ ', `å¼€å§‹${count}é¢˜å¿«é€Ÿå¤ä¹ æ¨¡å¼`);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // é”™é¢˜æœ¬åŠŸèƒ½
        function getWrongQuestions() {
            const wrongQuestionIds = reviewRecords
                .filter(r => !r.isCorrect)
                .map(r => r.questionId);
            
            const uniqueWrongIds = [...new Set(wrongQuestionIds)];
            return questions.filter(q => uniqueWrongIds.includes(q.id));
        }

        function reviewWrongQuestions() {
            const wrongQuestions = getWrongQuestions();
            if (wrongQuestions.length === 0) {
                showAlert('æç¤º', 'æš‚æ— é”™é¢˜è®°å½•');
                return;
            }
            
            // è®¾ç½®ä¸ºé”™é¢˜å¤ä¹ æ¨¡å¼
            questions = wrongQuestions;
            currentQuestionIndex = 0;
            showCurrentQuestion();
            showAlert('é”™é¢˜å¤ä¹ ', `å¼€å§‹å¤ä¹ ${wrongQuestions.length}é“é”™é¢˜`);
        }

        // å­¦ä¹ è®¡åˆ’åŠŸèƒ½
        function createStudyPlan() {
            const totalQuestions = questions.length;
            if (totalQuestions === 0) {
                showAlert('æç¤º', 'è¯·å…ˆæ·»åŠ é¢˜ç›®');
                return;
            }
            
            const dailyTarget = Math.ceil(totalQuestions / 7); // ä¸€å‘¨å†…å®Œæˆ
            const plan = {
                totalQuestions,
                dailyTarget,
                startDate: new Date().toISOString().split('T')[0],
                progress: 0
            };
            
            localStorage.setItem('baguwen_study_plan', JSON.stringify(plan));
            showAlert('å­¦ä¹ è®¡åˆ’', `å·²åˆ›å»ºå­¦ä¹ è®¡åˆ’ï¼šæ¯æ—¥å¤ä¹ ${dailyTarget}é¢˜ï¼Œé¢„è®¡7å¤©å®Œæˆ`);
        }

        // ç»Ÿè®¡å›¾è¡¨ï¼ˆç®€å•çš„æ–‡æœ¬å›¾è¡¨ï¼‰
        function generateProgressChart() {
            const last7Days = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayRecords = reviewRecords.filter(r => 
                    r.reviewTime.includes(dateStr)
                );
                
                last7Days.push({
                    date: dateStr,
                    count: dayRecords.length,
                    correct: dayRecords.filter(r => r.isCorrect).length
                });
            }
            
            return last7Days;
        }

        // å¯¼å‡ºä¸ºPDFï¼ˆç®€å•å®ç°ï¼‰
        function exportToPDF() {
            let content = 'å…«è‚¡æ–‡å¤ä¹ ç³»ç»Ÿ - å­¦ä¹ æŠ¥å‘Š\n\n';
            content += `æ€»é¢˜ç›®æ•°ï¼š${questions.length}\n`;
            content += `å·²ç»ƒä¹ ï¼š${new Set(reviewRecords.map(r => r.questionId)).size}\n`;
            content += `æ€»æ­£ç¡®ç‡ï¼š${reviewRecords.length > 0 ? (reviewRecords.filter(r => r.isCorrect).length / reviewRecords.length * 100).toFixed(1) : 0}%\n\n`;
            
            content += 'æœ€è¿‘ç»ƒä¹ è®°å½•ï¼š\n';
            reviewRecords.slice(0, 10).forEach((record, index) => {
                content += `${index + 1}. ${record.questionTitle} - ${record.isCorrect ? 'æ­£ç¡®' : 'é”™è¯¯'} - ${record.reviewTime}\n`;
            });
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å­¦ä¹ æŠ¥å‘Š_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // é”®ç›˜å¿«æ·é”®æ‰©å±•
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        if (!document.getElementById('manage-page').classList.contains('hidden')) {
                            saveQuestion();
                        }
                        break;
                    case 'n':
                        e.preventDefault();
                        if (!document.getElementById('manage-page').classList.contains('hidden')) {
                            addNewQuestion();
                        }
                        break;
                    case 'e':
                        e.preventDefault();
                        exportData();
                        break;
                }
            }
        });

        // æ·»åŠ æ›´å¤šå®ç”¨å·¥å…·å‡½æ•°
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function getQuestionsByCategory() {
            const categories = {};
            questions.forEach(q => {
                const category = q.category || 'æœªåˆ†ç±»';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(q);
            });
            return categories;
        }

        function getQuestionsByDifficulty() {
            const difficulties = { EASY: [], MEDIUM: [], HARD: [] };
            questions.forEach(q => {
                if (difficulties[q.difficulty]) {
                    difficulties[q.difficulty].push(q);
                }
            });
            return difficulties;
        }

        // å…¨å±æ¨¡å¼
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // å¤œé—´æ¨¡å¼ï¼ˆæŠ¤çœ¼æ¨¡å¼ï¼‰
        function toggleNightMode() {
            document.body.classList.toggle('night-mode');
            localStorage.setItem('baguwen_night_mode', document.body.classList.contains('night-mode'));
        }

        // è¯­éŸ³åˆæˆè®¾ç½®
        function updateSpeechSettings() {
            const rate = document.getElementById('speech-rate').value;
            localStorage.setItem('baguwen_speech_rate', rate);
        }

        // åŠ è½½è¯­éŸ³è®¾ç½®
        function loadSpeechSettings() {
            const savedRate = localStorage.getItem('baguwen_speech_rate') || '1';
            document.getElementById('speech-rate').value = savedRate;
        }

        // å¤ä¹ æé†’
        function setReviewReminder() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        setTimeout(() => {
                            new Notification('å…«è‚¡æ–‡å¤ä¹ æé†’', {
                                body: 'è¯¥å¤ä¹ äº†ï¼åšæŒæ¯å¤©ç»ƒä¹ ï¼Œæé«˜æŠ€æœ¯æ°´å¹³ã€‚',
                                icon: '/favicon.ico'
                            });
                        }, 30 * 60 * 1000); // 30åˆ†é’Ÿåæé†’
                    }
                });
            }
        }

        // æ€§èƒ½ç›‘æ§
        function logPerformance(action, startTime) {
            const endTime = performance.now();
            const duration = endTime - startTime;
            console.log(`${action} è€—æ—¶: ${duration.toFixed(2)}ms`);
        }

        // é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€é”™è¯¯:', e);
            showAlert('é”™è¯¯', 'å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        });

        // ç¦»çº¿æ”¯æŒæ£€æµ‹
        window.addEventListener('online', function() {
            showAlert('ç½‘ç»œ', 'ç½‘ç»œè¿æ¥å·²æ¢å¤');
        });

        window.addEventListener('offline', function() {
            showAlert('ç½‘ç»œ', 'ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œåº”ç”¨å°†ç»§ç»­åœ¨ç¦»çº¿æ¨¡å¼ä¸‹å·¥ä½œ');
        });

        console.log('ğŸ§  å…«è‚¡æ–‡å¤ä¹ ç³»ç»Ÿå·²åŠ è½½å®Œæˆï¼');
        console.log('ğŸ“š ç³»ç»ŸåŠŸèƒ½ï¼š');
        console.log('   - é¢˜ç›®ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰');
        console.log('   - æ™ºèƒ½å¤ä¹ ï¼ˆé¡ºåº/éšæœºï¼‰');
        console.log('   - è¯­éŸ³åŠŸèƒ½ï¼ˆæœ—è¯»/è¯†åˆ«ï¼‰');
        console.log('   - ç»Ÿè®¡åˆ†æ');
        console.log('   - æ•°æ®å¯¼å…¥å¯¼å‡º');
        console.log('   - å¤šä¸»é¢˜åˆ‡æ¢');
        console.log('ğŸ’¡ å¿«æ·é”®ï¼šSpace(è¯­éŸ³) Enter(æäº¤) â†â†’(åˆ‡é¢˜)');
    </script>
</body>
</html>
# 防止接口被恶意刷流量，除了限流还应在代码层面做哪些防护？

除了常规的限流措施，代码层面还可以从以下几个方面加强接口安全，防止被恶意刷流量：

---

## 1️⃣ 参数校验与过滤

- **严格验证参数合法性**：对所有入参做类型、长度、格式、范围等校验，避免异常参数导致资源耗尽或系统崩溃。
  - 例：手机号11位，邮箱正则，list数组大小限制，数值上下限等。
  - 使用如`@NotNull`、`@Min`、`@Max`等注解或手动校验。

---

## 2️⃣ 验证码与行为验证

- **验证码拦截**：对关键接口要求用户输入验证码（如滑块、拼图、文字识别等），提升机刷门槛。
- **行为验证码**：如滑动行为、鼠标轨迹等人机识别方式，增强安全性。

---

## 3️⃣ Token 校验

- **接口鉴权**：需要登录态或特定token才能访问，token可定期刷新，防止泄露被滥用。
- **临时token/一次性token**：重要操作可要求一次性token，防止重放攻击。

---

## 4️⃣ 签名验签

- **接口签名校验**：对外API建议对请求参数进行加签验签，防止参数被篡改，保障请求来源可信。
- 常用于开放平台、支付等场景。

---

## 5️⃣ 行为逻辑关联校验

- **操作流程关联性校验**：如下单前必须有加购、验证码必须在3分钟内使用等，避免绕过正常流程直接调用核心接口。
- 检查用户行为流程的完整性与合理性，防止绕流程刷接口。

---

## 6️⃣ 防护脚本与风控识别

- **设备指纹识别**：采集User-Agent、IP、分辨率、Canvas指纹等生成设备唯一标识，防止同一设备频繁刷接口。
- **人机识别服务集成**：如图灵测试、行为分析、IP信誉库等。
- **请求频率与时间间隔检测**：监控同一用户/设备/账号的请求频次和间隔，异常则拦截或风控。
- **IP/地理/ASN分析**：识别代理、异常地域、可疑ASN等来源，标记高危流量。
- **历史行为统计与黑名单**：结合历史请求行为，识别异常模式，动态加入黑名单。

---

## 7️⃣ 其他建议

- **接口返回统一格式，避免暴露细节信息**
- **敏感操作加强日志审计，便于溯源和追责**
- **配合安全团队/风控系统做更深层次的异常流量检测**

---

> 💡 **总结：**
> - 严格参数校验、验证码、Token鉴权、签名、安全流程、设备指纹、行为分析等手段多重并用，能极大提升接口抗刷能力。
> - 核心思想：让“刷接口”变得更难、更贵、更易被发现。
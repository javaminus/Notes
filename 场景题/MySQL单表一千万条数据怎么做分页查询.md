# MySQL单表一千万条数据如何分页查询？

面对千万级数据量的MySQL单表，分页查询需要兼顾**查询效率**和**用户体验**。下面总结常见优化思路和实现方式：

---

## 1️⃣ 必须使用索引

- **走索引（尤其是主键/唯一索引）**：避免全表扫描  
  ```sql
  SELECT * FROM large_table WHERE id > 0 ORDER BY id ASC LIMIT 100;
  ```
- **覆盖索引**：只查询索引包含的字段，减少回表，提高效率
- **索引下推**：让WHERE条件尽可能利用索引过滤

---

## 2️⃣ 避免深分页（OFFSET过大）

> 深分页指的是如 `LIMIT 999990, 10` 这种跳过大量数据的查询，MySQL会扫描前面所有999990条记录，性能极差！

### ✅ 推荐方案一：基于上次最大ID分页（游标/Keyset分页）

每次分页时，记住上一页最后一条记录的ID，下一页直接用ID做条件  
```sql
-- 第1页
SELECT * FROM large_table WHERE id > 0 ORDER BY id ASC LIMIT 100;

-- 第N页（上一页最后一条数据id为500）
SELECT * FROM large_table WHERE id > 500 ORDER BY id ASC LIMIT 100;
```
**优点：** 性能稳定、支持任意页跳转、适合ID单调递增的场景

---

### ✅ 推荐方案二：子查询定位分页起点

通过子查询先找到目标页的起始ID，再查目标数据  
```sql
SELECT * FROM large_table 
WHERE id >= (
    SELECT id FROM large_table ORDER BY id ASC LIMIT 1000, 1
)
ORDER BY id ASC 
LIMIT 100;
```
**优点：** 避免扫描无效行  
**缺点：** ID不连续时不适用

---

### ✅ 推荐方案三：倒序查询末页

分页查询最后几页时，倒序扫描数据量更少  
```sql
SELECT * FROM large_table ORDER BY id DESC LIMIT 100;
```

---

## 3️⃣ 其他建议

- **合理控制单页大小**（如每页100条），避免单次返回过多数据
- **定期归档/分表**，减少单表数据量
- **缓存热点数据**，减轻数据库压力

---

## ⚠️ 不推荐

- 直接用 `LIMIT offset, size` 进行深分页（如 `LIMIT 999990, 10`），极易造成慢SQL和数据库压力暴增

---

## 总结表

|      场景       |      推荐分页方式      |    优点    |      注意事项      |
| :-------------: | :--------------------: | :--------: | :----------------: |
|   常规前几页    |  `LIMIT offset, size`  |    简单    | Offset较小时无压力 |
| 深分页/大数据量 | 基于ID分页、子查询定位 | 性能高，快 | 需有合适索引/主键  |
|    查询末页     |        倒序分页        |  扫描量小  |   之后再正序重排   |

---

> 💡 **核心思路：优先走索引，避免OFFSET深分页，推荐基于主键游标分页！**
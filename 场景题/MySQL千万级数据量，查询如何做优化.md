# MySQL千万级数据量查询优化指南

千万级数据量，对MySQL来说其实并不算极限，只要方法得当，不必急着分库分表、上ES或分布式数据库。下面是优化思路与建议。

---

## 1️⃣ 索引优化 —— 查询提速最直接手段

- **索引类型选择**
  - 常用B+树索引，适合范围、排序、模糊等查询。
  - Hash索引适合等值查询场景（如MEMORY表）。

- **联合索引（组合索引）**
  - 多条件查询建议建立联合索引，提高过滤效率。
  - 注意最左前缀原则，WHERE条件尽量匹配索引顺序。

- **覆盖索引**
  - 查询只用到索引中的字段（覆盖索引），可避免回表，IO更少，性能极高。
  - 例：`SELECT id, name FROM user WHERE id > 1000;`（若id、name均在索引中）

- **防止索引失效**
  - 避免在WHERE条件用函数或类型不一致、未按最左前缀等。
  - 用`EXPLAIN`分析SQL，确认是否真正用到索引。

- **索引字段区分度要高**
  - 区分度高（如手机号、订单号）更能过滤数据，查询更快。
  - 特殊场景下区分度低字段如性别，慎用为主索引。

---

## 2️⃣ 避免多表JOIN

- JOIN操作开销大，建议通过**冗余字段**减少JOIN。
- 必须JOIN时，用**小表驱动大表**，并确保关联字段有索引。

---

## 3️⃣ 避免 `select *`

- 只查需要的字段，减少数据传输与磁盘IO，利于索引覆盖。

---

## 4️⃣ 分页优化，避免深分页

- 千万级表用`LIMIT offset, size`深分页极慢。
- 推荐**基于主键/游标分页**，如：
  ```sql
  SELECT * FROM large_table WHERE id > 上一页最大id ORDER BY id ASC LIMIT 100;
  ```
- 或子查询定位起点，减少无效扫描。
- 查询最后几页可用倒序分页。

---

## 5️⃣ 降低事务粒度

- 长事务占用连接，影响整体并发。
- 拆分事务，减少单次事务操作量，释放连接资源。

---

## 6️⃣ 利用缓存

- 业务热点数据建议走**Redis等外部分布式缓存**，减轻DB压力。
- 不推荐直接用MySQL/MyBatis自带缓存，推荐业务层自控。

---

## 7️⃣ 数据归档

- 冷历史数据可定期迁移到归档表，主表只保留活跃（热）数据，提升查询效率。

---

## 8️⃣ 硬件升级

- 高并发大数据量场景，提升CPU、内存、磁盘、网络等硬件规格，提升吞吐能力。

---

## 9️⃣ 其他补充

- 合理设计表结构，避免行太宽、单表过大。
- 数据库参数优化（缓冲区、连接池等）。
- 若上述措施无效，再考虑分库分表、引入ES等中间件。

---

> ⚡️ **总 结**  
> 优先索引优化、减少JOIN、分页优化、合理事务、用缓存和归档，千万级数据不难搞。  
> 基础做扎实了，MySQL单表抗住几千万查询完全没问题！
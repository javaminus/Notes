## 服务器处理并发请求的常见方式

---

### 1. 多进程（Process-based）

- 每收到一个请求，服务器创建一个新的进程进行处理，或维护进程池。
- **优点**：进程隔离性强，单个进程故障不影响整体。
- **缺点**：进程创建和切换开销大，资源消耗高，扩展性有限。
- **典型应用**：早期 Apache HTTP Server（prefork 模式）、部分 CGI 程序。

---

### 2. 多线程（Thread-based）

- 服务器为每个请求分配一个线程，或使用线程池复用线程。
- **优点**：线程切换比进程快，资源消耗较低。
- **缺点**：线程间共享内存需加锁，易出现同步与安全问题。
- **典型应用**：Java Servlet、Tomcat、Nginx（worker 多进程+每进程多线程）。

---

### 3. 异步非阻塞 I/O（事件驱动/IO复用）

- 采用单进程/单线程，利用事件循环（如 epoll、select、kqueue）异步处理大量连接。
- **优点**：高并发、低资源消耗，适合 I/O 密集型应用。
- **缺点**：编程模型复杂，适合无阻塞操作。
- **典型应用**：Nginx、Node.js、Redis、Netty。

---

### 4. 协程（Coroutine/轻量级线程/用户态线程）

- 在单线程中通过协程调度，实现高并发，避免线程切换开销。
- **优点**：极低的上下文切换开销，代码可读性强。
- **缺点**：依赖语言/库支持，阻塞操作需特殊处理。
- **典型应用**：Go（Goroutine）、Python（asyncio、gevent）、Quark等。

---

### 5. 结合模型

- 实际服务器常结合多种方式（如多进程 + 多线程 + 异步 I/O），以兼顾性能与稳定性。
- **典型应用**：Nginx（多进程+事件驱动）、Java Netty（多线程+异步 I/O）、现代 Web 框架等。

---

## 总结

服务器并发模型主要有多进程、多线程、异步非阻塞 I/O、协程等，每种方式有不同的适用场景和优缺点，实际生产环境多为多种模型结合优化高并发能力。

## 服务器并发处理方式——面试官常问问题与参考答案

---

### 1. 多进程和多线程模型的区别？各自优缺点？

**参考答案：**  
多进程模型为每个请求创建独立进程，进程间隔离性好，单个进程崩溃不影响整体，但资源开销大，切换成本高。多线程模型为每个请求分配线程，线程间共享内存，资源消耗小，切换开销低，但需注意线程安全和同步问题，单个线程异常可能影响整个进程。

---

### 2. 什么是事件驱动（异步 I/O）？相比多线程/进程有何优势？

**参考答案：**  
事件驱动（异步 I/O）通过单线程配合事件循环处理大量并发连接，利用 IO 多路复用（如 epoll、select）监听事件，适合 I/O 密集场景。优势是内存和线程消耗低，性能高，缺点是编程复杂度提升，不适合大量 CPU 密集型任务。

---

### 3. 协程与线程的区别？协程适合什么场景？

**参考答案：**  
协程是用户态的轻量级线程，由程序自身调度，切换开销极低，适合高并发 I/O 场景。线程是内核调度，资源消耗更高。协程适合大量 I/O 密集、上下文切换频繁但无需抢占式调度的场景，如高并发服务器、网络爬虫等。

---

### 4. 高并发场景下如何避免服务器资源耗尽？

**参考答案：**  
可采用连接池、线程池、限制最大连接数、异步 I/O、负载均衡等手段，防止资源被耗尽。合理回收超时连接、优化任务队列与调度策略也是常见做法。

---

### 5. 分布式环境下 Session 如何保持一致性？

**参考答案：**  
可将 Session 存储在集中式存储（如 Redis、数据库），实现多服务器共享；或使用一致性哈希等负载均衡策略将同一用户请求路由到同一服务器；也可采用 JWT 等无状态 Token。

---

### 6. Nginx、Node.js、Tomcat 常用的并发模型是什么？各有什么优点？

**参考答案：**  
Nginx 采用多进程+事件驱动模型，适合高并发静态资源；Node.js 采用单线程事件驱动，适合高并发 I/O 应用；Tomcat 采用多线程（线程池）模型，适合处理大量 Web 请求。各自根据应用场景选择最优并发模型。

---

## 总结

面试追问时，结合多进程、多线程、异步 I/O、协程等原理，深入理解其优缺点及适用场景，并能结合实际架构案例灵活分析。
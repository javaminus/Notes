# MySQL突然断电会发生数据丢失吗？

## 1️⃣ InnoDB存储引擎

- **大多数情况下，配置得当时（如 `innodb_flush_log_at_trx_commit=1`），突然断电不会丢失已提交的数据。**
- 依靠**事务日志（redo log）**进行崩溃恢复，已提交的数据可以恢复，**未提交的事务会被回滚**（即未提交的数据会丢失）。

### `innodb_flush_log_at_trx_commit` 解释：

| 配置值 |                     行为                     |     丢失风险      |
| :----: | :------------------------------------------: | :---------------: |
|   0    |  日志每秒刷盘，事务提交时不保证立即写入磁盘  | 可能丢失1秒内数据 |
|   1    | 每次提交事务都将日志写入磁盘（默认，最安全） |   理论不丢数据    |
|   2    |         日志写到文件但每秒才刷一次盘         | 可能丢失1秒内数据 |

> 推荐**生产环境使用1**，最大限度保证数据安全，但性能略低。

---

## 2️⃣ MyISAM存储引擎

- **没有事务机制和崩溃恢复日志**，断电极易导致表损坏或数据丢失。
- 不建议在需高数据安全的业务中使用MyISAM。

---

## 3️⃣ 磁盘/操作系统缓存影响

- **即使MySQL配置安全**，现代操作系统/硬件通常有磁盘缓存，数据写入可能先到缓存，未落盘时断电仍有丢失风险。
- **完全避免风险**的做法包括：
  - 关闭磁盘写缓存（但性能大幅降低）
  - 使用带写缓存保护的专用磁盘/RAID卡
  - 部署**UPS（不间断电源）**，保证有序关机

---

## 4️⃣ 扩展知识

- **InnoDB事务日志（redo log）**用于保证已提交事务的持久性，断电后可恢复到事务提交时的状态。
- **binlog**用于主从复制和数据恢复，配合`sync_binlog=1`可增强安全性。
- **2阶段提交**机制保证了binlog和redolog的一致性。

---

## 5️⃣ 结论

- **已提交事务**：一般不会丢失（前提：InnoDB+配置合理+硬件保障）
- **未提交事务**：会丢失
- **硬件或配置不当**：可能丢失1秒内数据，甚至更多

> ⚠️ 为避免数据丢失，建议用InnoDB+合理配置+UPS/硬件冗余，关键业务场景需格外注意！

---

> 💡 **最佳实践：**
> - 生产环境务必使用 InnoDB 存储引擎  
> - 配置 `innodb_flush_log_at_trx_commit=1`  
> - 配置 `sync_binlog=1`  
> - 采用 UPS/硬件冗余  
> - 重要数据定期备份
##  为什么不推荐字段注入？

### a. 测试困难

- 字段是private的，Mock对象不好注入，测试时一般要用反射，非常麻烦。
- 构造器注入可以直接`new UserService(mockUserRepository)`，很方便。

### b. 不可变性差

- 字段注入不能保证这个依赖不会被更改（不是final的）。
- 构造器注入可以让依赖是final，保证对象一旦创建，依赖就不会变，线程安全、健壮。

> 当然可以，下面详细解释一下这句话的意思：
>
> ---
>
> ### 1. 构造器注入可以让依赖是final
>
> **构造器注入**，就是通过构造方法来传递依赖对象。例如：
>
> ```java
> public class UserService {
>     private final UserRepository userRepository;
> 
>     public UserService(UserRepository userRepository) {
>         this.userRepository = userRepository;
>     }
> }
> ```
>
> 这里，`userRepository` 声明为 `final`，只能在构造方法里赋值一次，之后不能再被修改。
>
> ---
>
> ### 2. 保证对象一旦创建，依赖就不会变
>
> 由于 `final` 修饰，`userRepository` 只能赋值一次，创建 `UserService` 对象时就确定了。**对象一旦创建好，它依赖的 userRepository 就“定死了”，后面不可能被改掉。**
>
> ---
>
> ### 3. 线程安全
>
> - `final` 字段一旦初始化后，其他线程无法看到未初始化的状态（Java内存模型保证）。
> - 不会出现某个线程刚拿到这个对象，依赖还没注入完或者被别的线程改掉的情况。
> - 所以这样写更**线程安全**。
>
> ---
>
> ### 4. 健壮
>
> - 对象的依赖关系清晰且不可更改，代码更可靠，不容易因为意外赋值出错。
> - 万一有人在别的地方试图修改依赖，编译器会直接报错，避免了运行时的错误。
>
> ---
>
> ### 总结
>
> > 构造器注入 + final 字段 = 依赖只初始化一次，之后不可变。这样写出来的类更安全、更健壮，也更容易维护和测试。
>

### c. 依赖关系不明显

- 字段注入时，看类的声明，你不知道这个类到底需要哪些依赖。
- 构造器注入时，所有依赖都写在构造方法参数里，一目了然，别人用你的类时也知道必须传哪些参数。

### d. 重构和维护难

- 字段注入让依赖分散在各个字段上，一不小心就漏掉了，特别是依赖多的类。
- 构造器注入可以很容易查找和管理依赖项。

### e. 破坏封装

- Spring底层会用反射给private字段赋值，本质上破坏了面向对象的封装性原则。

------

## 3. 推荐用什么注入方式？

- **构造器注入**是最推荐的（也是Spring官方推荐）。
  - 代码更清晰。
  - 支持不可变（final）。
  - 易于单元测试。
  - 依赖一目了然。
- Setter注入有时用在可选依赖的场景。

------

## 4. 总结

| 注入方式   | 可测性 | 依赖显式 | 支持不可变 | 推荐度   |
| ---------- | ------ | -------- | ---------- | -------- |
| 字段注入   | 差     | 隐式     | 不支持     | 最不推荐 |
| Setter注入 | 一般   | 一般     | 不支持     | 可选     |
| 构造器注入 | 最好   | 最显式   | 支持       | 最推荐   |

------

**一句话总结：**
字段注入虽然方便，但带来很多维护和测试上的问题。构造器注入虽多写几行，但代码更健壮、更易维护和测试。
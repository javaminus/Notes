## 高频高并发面试题 —— “高并发下如何进行限流？常见限流算法和场景分析”

### 问题
在高并发系统中，如何有效地对接口或服务进行限流？请详细说明常见限流算法（如漏桶、令牌桶、计数器等），分析它们的原理、适用场景及优缺点，并结合实际业务举例。

---

### 详细解释

#### 1. 业务场景

- 秒杀、抢购等活动时，短时间内大量流量涌入，如果系统没有限流措施，可能导致服务崩溃、数据库压力激增，甚至影响整个业务系统的稳定性。
- API网关、微服务接口等也常需要限流防止被恶意刷接口。

#### 2. 常见限流算法

- **固定窗口计数器（Fixed Window Counter）**
  - 在固定时间窗口内统计请求数，超过阈值则拒绝请求。
  - **优点**：实现简单。
  - **缺点**：窗口临界点可能出现流量突刺（如59秒和60秒间都被允许）。
  - **场景**：简单接口QPS限制。

- **滑动窗口计数器（Sliding Window Counter）**
  - 将时间窗口划分为多个小窗口，统计最近N个窗口内的请求总数。
  - **优点**：平滑流量，防止突刺。
  - **缺点**：实现较复杂。
  - **场景**：对突发流量敏感的业务。

- **漏桶算法（Leaky Bucket）**
  - 请求先进入漏桶，按固定速度流出处理，超出速率的请求被丢弃或排队。
  - **优点**：严格控制流出速率，平滑突发流量。
  - **缺点**：可能导致请求延迟或丢弃。
  - **场景**：带宽、消息队列等场景。

- **令牌桶算法（Token Bucket）**
  - 按一定速率往桶里放令牌，请求需获取令牌才能处理，桶满则丢弃新令牌，没令牌则拒绝请求。
  - **优点**：允许一定程度的突发流量，灵活性高。
  - **缺点**：实现稍复杂。
  - **场景**：允许突发的接口流控、支付、抢购等。

#### 3. 实际举例

在电商秒杀业务中，通常使用令牌桶算法，每秒生成固定数量的令牌，用户请求需要“抢”到令牌才能继续下单。超出速率的请求直接被拒绝，有效防止数据库和后端服务被击穿。

API网关会用滑动窗口计数器来平滑控制单个用户或IP的访问频率，防止恶意刷接口。

#### 4. 技术细节与优化

- 分布式限流可用Redis、Guava等中间件实现。
- 限流应分层设计（如Nginx层、应用层、业务层），多级保护。
- 限流触发时可考虑降级、友好提示或排队处理。

---

### 总结性回答（复习提示词）

- **限流算法**：固定窗口、滑动窗口、漏桶、令牌桶
- **高并发推荐**：令牌桶适合突发，漏桶适合平滑，滑动窗口防突刺
- **记忆口诀**：窗口计数易突刺，漏桶平滑流量忙，令牌桶突发抗压强
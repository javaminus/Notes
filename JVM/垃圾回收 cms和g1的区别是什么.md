### **CMS vs G1 垃圾回收器的区别**

| **对比项**       | **CMS（Concurrent Mark-Sweep）**       | **G1（Garbage First）**                |
| ---------------- | -------------------------------------- | -------------------------------------- |
| **回收策略**     | 低停顿，基于**标记-清除**算法          | 低延迟，基于**区域化复制+增量整理**    |
| **垃圾收集目标** | 适用于**低延迟应用**，减少**Full GC**  | 适用于**大堆内存，均衡延迟与吞吐量**   |
| **内存划分**     | **老年代 + 新生代（Eden + Survivor）** | **分区（Region）管理，全堆垃圾回收**   |
| **STW 停顿时间** | 短，但**可能有碎片化问题**             | 更可预测，目标化控制停顿时间           |
| **回收过程**     | 并发**标记-清除**（易碎片）            | 复制整理（无碎片，减少 Full GC）       |
| **吞吐量**       | 高，但可能**STW 不可控**               | 略低，但**STW 时间可预测**             |
| **适用场景**     | **低延迟需求（如电商、金融系统）**     | **大内存应用（如大数据、高并发服务）** |
| **废弃情况**     | JDK 9 之后被**标记为废弃**             | JDK 9+ **默认垃圾回收器**              |

------

### **CMS 回收流程**

1. **初始标记（STW）**：标记 GC Roots 直接可达对象
2. **并发标记**：扫描整个堆，标记可达对象
3. **重新标记（STW）**：修正并发标记阶段遗漏的对象
4. **并发清除**：清理不可达对象（不压缩堆，可能造成碎片化）

**缺点**：
 ❌ **容易内存碎片化**，可能导致 Full GC
 ❌ **高并发压力下 STW 仍可能过长**

------

### **G1 回收流程**

1. **全堆分区（Region）**，不再区分老年代和新生代
2. **优先回收垃圾最多的 Region**（"Garbage First"）
3. **阶段性并发标记，预测回收停顿时间**
4. **复制整理，减少碎片化，提升吞吐量**

**优点**：
 ✅ **可控 STW 停顿时间（Predictable Pause Time）**
 ✅ **避免碎片化，适用于大堆内存（6GB+）**
 ✅ **适合高并发、大数据系统**

------

### **如何选择？**

- **CMS**：适用于**低延迟应用（如金融、秒杀）**，但易碎片化，JDK 9 已废弃
- **G1**：适用于**大堆（6GB+）、高并发场景（如大数据、微服务）**，JDK 9+ 默认

🚀 **JDK 11 及以上建议直接使用 G1**，JDK 17 还可考虑 **ZGC / Shenandoah** 低延迟 GC！